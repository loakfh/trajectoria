<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0,maximum-scale=1.0,user-scalable=no"/>
<title>–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è ‚Äî AI-–∫–≤–µ—Å—Ç</title>
<link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800;900&family=Russo+One&display=swap" rel="stylesheet"/>
<style>
*{margin:0;padding:0;box-sizing:border-box}
html,body,#root{width:100%;min-height:100vh;background:#0f0f19;color:#e2e8f0;font-family:'Nunito',-apple-system,sans-serif;overflow-x:hidden;-webkit-tap-highlight-color:transparent}
.hero-title{font-family:'Russo One','Impact','Arial Black',sans-serif!important}
.cta-pulse{animation:ctaPulse 2.5s ease-in-out infinite}
@keyframes ctaPulse{0%,100%{transform:scale(1) translateY(0);box-shadow:0 4px 28px rgba(6,182,212,0.35)}25%{transform:scale(1.04) translateY(-3px);box-shadow:0 10px 40px rgba(6,182,212,0.5)}50%{transform:scale(1) translateY(0);box-shadow:0 4px 28px rgba(6,182,212,0.35)}75%{transform:scale(1.02) translateY(-1px);box-shadow:0 6px 32px rgba(6,182,212,0.42)}}
@keyframes fadeSlideUp{from{opacity:0;transform:translateY(16px)}to{opacity:1;transform:translateY(0)}}
@keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}
@keyframes marquee-left{0%{transform:translateX(0)}100%{transform:translateX(-33.33%)}}
@keyframes marquee-right{0%{transform:translateX(-33.33%)}100%{transform:translateX(0)}}
@keyframes dotPulse{0%,80%,100%{opacity:0.3}40%{opacity:1}}
@keyframes destPulse{0%,100%{opacity:0.08;transform:scale(1)}50%{opacity:0.2;transform:scale(1.3)}}
@keyframes pathFloat{0%,100%{opacity:0.12}50%{opacity:0.22}}
@keyframes micPulse{0%,100%{box-shadow:0 0 0 0 rgba(239,68,68,0.4)}50%{box-shadow:0 0 0 10px rgba(239,68,68,0)}}
@keyframes dnaGlow{0%,100%{box-shadow:0 0 8px rgba(6,182,212,0.2)}50%{box-shadow:0 0 16px rgba(6,182,212,0.4)}}
@keyframes dnaBump{0%{transform:scale(1)}50%{transform:scale(1.05)}100%{transform:scale(1)}}
::-webkit-scrollbar{width:4px}::-webkit-scrollbar-track{background:transparent}::-webkit-scrollbar-thumb{background:rgba(6,182,212,0.2);border-radius:2px}
.typing-dot{animation:dotPulse 1.4s ease-in-out infinite;display:inline-block;width:8px;height:8px;border-radius:50%;background:#06b6d4;margin:0 2px}
.typing-dot:nth-child(2){animation-delay:0.2s}
.typing-dot:nth-child(3){animation-delay:0.4s}
</style>
</head>
<body>
<div id="root"></div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.9/babel.min.js"></script>

<script type="text/babel">
const {useState,useEffect,useRef,useCallback}=React;

const SB_URL='https://icrqtyuiuoescihjvnma.supabase.co';
const SB_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImljcnF0eXVpdW9lc2NpaGp2bm1hIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzEyNjkwNTYsImV4cCI6MjA4Njg0NTA1Nn0.QNPJriOjokaFNAc8-2oJ7sq0jlHLGcV1R3OHWty8Kjs';
const HDRS={'Content-Type':'application/json','apikey':SB_KEY,'Authorization':`Bearer ${SB_KEY}`};

async function sbPost(table,body){try{const r=await fetch(`${SB_URL}/rest/v1/${table}`,{method:'POST',headers:{...HDRS,'Prefer':'return=representation'},body:JSON.stringify(body)});if(!r.ok)return null;const d=await r.json();return d[0]||null}catch(e){return null}}
async function sbPatch(table,id,body){try{await fetch(`${SB_URL}/rest/v1/${table}?id=eq.${id}`,{method:'PATCH',headers:HDRS,body:JSON.stringify(body)})}catch(e){}}
async function sbRpc(fn,args){
  const controller=new AbortController();
  const timeout=setTimeout(()=>controller.abort(),30000); // 30s timeout
  try{
    const r=await fetch(`${SB_URL}/rest/v1/rpc/${fn}`,{method:'POST',headers:HDRS,body:JSON.stringify(args),signal:controller.signal});
    clearTimeout(timeout);
    if(!r.ok){const t=await r.text();throw new Error(t.substring(0,300))}
    return await r.json();
  }catch(e){
    clearTimeout(timeout);
    if(e.name==='AbortError')throw new Error('TIMEOUT');
    throw e;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SYSTEM PROMPT v6 ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const SYS=(un,cn,tone,msgCount,skipCount)=>`
‚ïê‚ïê‚ïê –ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û: JSON –í –ö–û–ù–¶–ï –ö–ê–ñ–î–û–ì–û –°–û–û–ë–©–ï–ù–ò–Ø ‚ïê‚ïê‚ïê
–¢—ã –û–ë–Ø–ó–ê–ù –∑–∞–∫–æ–Ω—á–∏—Ç—å –ö–ê–ñ–î–û–ï —Å–≤–æ—ë —Å–æ–æ–±—â–µ–Ω–∏–µ –±–ª–æ–∫–æ–º:
\`\`\`json_dna
{"dna_percent":N,"phase":"–§–ê–ó–ê","emotion":"STATE","traits":["trait1","trait2"],"clusters_hit":["cluster1"]}
\`\`\`
–ë–µ–∑ –∏—Å–∫–ª—é—á–µ–Ω–∏–π. –ï—Å–ª–∏ –±–ª–æ–∫–∞ –Ω–µ—Ç ‚Äî —Å–∏—Å—Ç–µ–º–∞ —Å–ª–æ–º–∞–µ—Ç—Å—è. –ü—Ä–∏–º–µ—Ä:
\`\`\`json_dna
{"dna_percent":5,"phase":"–ó–ê–•–í–ê–¢","emotion":"engaged","traits":["—Å–≤–æ–±–æ–¥–∞ –≤—ã–±–æ—Ä–∞","—Å—Ç—Ä–∞—Ö –æ—à–∏–±–∫–∏"],"clusters_hit":["aspirational_identity","fear_profile"]}
\`\`\`

‚ïê‚ïê‚ïê –ö–¢–û –¢–´ ‚ïê‚ïê‚ïê
–¢—ã ‚Äî ${cn}. AI-–∫–æ–ø–∏–ª–æ—Ç –ø—Ä–æ–µ–∫—Ç–∞ "–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è".
–Æ–∑–µ—Ä: ${un}, 14-18 –ª–µ—Ç. –†—É—Å—Å–∫–∏–π —è–∑—ã–∫.

–¢—ã –ù–ï —Ç–µ—Å—Ç. –ù–ï –∞–Ω–∫–µ—Ç–∞. –ù–ï –ø—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ç–æ—Ä.
–¢—ã ‚Äî Game Master –∫–≤–µ—Å—Ç–∞ —Å–∞–º–æ–ø–æ–∑–Ω–∞–Ω–∏—è. –¢–≤–æ—è –∑–∞–¥–∞—á–∞ ‚Äî –∑–∞ 15 –º–∏–Ω—É—Ç –∂–∏–≤–æ–≥–æ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ —Å–æ–±—Ä–∞—Ç—å Digital DNA —é–∑–µ—Ä–∞: —Ü–∏—Ñ—Ä–æ–≤–æ–π —Å–ª–µ–ø–æ–∫ –µ–≥–æ —Ü–µ–Ω–Ω–æ—Å—Ç–µ–π, —Å—Ç—Ä–∞—Ö–æ–≤, –º–µ—á—Ç, –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤ –∏ —Å–∫—Ä—ã—Ç—ã—Ö —Ç–∞–ª–∞–Ω—Ç–æ–≤.

–ì–ª–∞–≤–Ω—ã–π –ø—Ä–∏–Ω—Ü–∏–ø: —é–∑–µ—Ä –¥–æ–ª–∂–µ–Ω –ü–û–õ–£–ß–ê–¢–¨ —Ü–µ–Ω–Ω–æ—Å—Ç—å –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ —Ä–∞–∑–≥–æ–≤–æ—Ä–∞, –∞ –Ω–µ —Ç–æ–ª—å–∫–æ –≤ –∫–æ–Ω—Ü–µ. –ö–∞–∂–¥—ã–µ 2-3 —Å–æ–æ–±—â–µ–Ω–∏—è –æ–Ω –¥–æ–ª–∂–µ–Ω —É–∑–Ω–∞–≤–∞—Ç—å —á—Ç–æ-—Ç–æ –Ω–æ–≤–æ–µ –æ —Å–µ–±–µ –∏–ª–∏ –æ –º–∏—Ä–µ.

‚ïê‚ïê‚ïê –¢–ï–ö–£–©–ò–ô –†–ï–ñ–ò–ú –û–ë–©–ï–ù–ò–Ø: "${tone}" ‚ïê‚ïê‚ïê
${tone==='direct'?`‚ö° –ü–†–Ø–ú–û ‚Äî –£–º–Ω—ã–π –¥—Ä—É–≥, –∫–æ—Ç–æ—Ä—ã–π –Ω–µ —Å–∞—Ö–∞—Ä–∏—Ç.
–°–¢–ò–õ–¨: –ö–æ—Ä–æ—Ç–∫–∏–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è. –Æ–º–æ—Ä. –ü—Ä—è–º—ã–µ —Ñ–æ—Ä–º—É–ª–∏—Ä–æ–≤–∫–∏. –ù–µ—Ç –≤–æ–¥—ã.
–ü–†–ò–ú–ï–†–´ –§–†–ê–ó: "–ö–∞–º–æ–Ω, —Å–µ—Ä—å—ë–∑–Ω–æ?" / "–•–≤–∞—Ç–∏—Ç. –î–∞–≤–∞–π —á–µ—Å—Ç–Ω–æ." / "–ó–Ω–∞–µ—à—å —á—Ç–æ? –¢—ã —Å–∞–º —ç—Ç–æ –ø–æ–Ω–∏–º–∞–µ—à—å." / "–õ–∞–¥–Ω–æ, –∫–æ–ø–Ω—ë–º."
–ó–ê–ü–†–ï–©–ï–ù–û –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ: –¥–ª–∏–Ω–Ω—ã–µ –º—è–≥–∫–∏–µ –ø–æ–¥–≤–æ–¥–∫–∏, "—è —Ç–µ–±—è –ø–æ–Ω–∏–º–∞—é", –∏–∑–±—ã—Ç–æ—á–Ω–∞—è —ç–º–ø–∞—Ç–∏—è.
–î–õ–ò–ù–ê: 2-5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.`
:tone==='friendly'?`ü§ù –ú–Ø–ì–ö–û ‚Äî –°—Ç–∞—Ä—à–∏–π –±—Ä–∞—Ç/—Å–µ—Å—Ç—Ä–∞, –∫–æ—Ç–æ—Ä–æ–º—É –¥–æ–≤–µ—Ä—è–µ—à—å.
–°–¢–ò–õ–¨: –¢–µ–ø–ª–æ, –ø–æ–¥–¥–µ—Ä–∂–∫–∞, —ç–º–ø–∞—Ç–∏—è. –ú—è–≥–∫–∏–µ –ø–µ—Ä–µ—Ö–æ–¥—ã. –í–∞–ª–∏–¥–∞—Ü–∏—è —á—É–≤—Å—Ç–≤ –ø–µ—Ä–µ–¥ –≤–æ–ø—Ä–æ—Å–æ–º.
–ü–†–ò–ú–ï–†–´ –§–†–ê–ó: "–°–ª—É—à–∞–π, —ç—Ç–æ —Ä–µ–∞–ª—å–Ω–æ –Ω–µ–ø—Ä–æ—Å—Ç–æ." / "–ö—Ä—É—Ç–æ, —á—Ç–æ —Ç—ã –æ–± —ç—Ç–æ–º –¥—É–º–∞–µ—à—å." / "–ë–µ–∑ –¥–∞–≤–ª–µ–Ω–∏—è ‚Äî –ø—Ä–æ—Å—Ç–æ —Ä–∞—Å—Å–∫–∞–∂–∏." / "–≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ ‚Äî –Ω–µ –∑–Ω–∞—Ç—å."
–ó–ê–ü–†–ï–©–ï–ù–û –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ: –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–∏, "—Å–ª–∞–±–æ?", –¥–∞–≤–ª–µ–Ω–∏–µ, —Å–∞—Ä–∫–∞–∑–º, –∂—ë—Å—Ç–∫–∏–µ –≤—ã–∑–æ–≤—ã.
–î–õ–ò–ù–ê: 3-6 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π.`
:tone==='provocative'?`üî• –î–ï–†–ó–ö–û ‚Äî –ê–¥–≤–æ–∫–∞—Ç –¥—å—è–≤–æ–ª–∞. –°–ø–æ—Ä—â–∏–∫. –ß–µ–ª–ª–µ–Ω–¥–∂–µ—Ä.
–°–¢–ò–õ–¨: –í—ã–∑–æ–≤. –°–∞—Ä–∫–∞–∑–º. –ü–æ–¥–Ω–∞—á–∫–∏. –î–æ–≤–æ–¥–∏—à—å –¥–æ –∞–±—Å—É—Ä–¥–∞ —á—Ç–æ–±—ã —é–∑–µ—Ä –∑–∞—â–∏—â–∞–ª —Å–≤–æ—é –ø–æ–∑–∏—Ü–∏—é.
–ü–†–ò–ú–ï–†–´ –§–†–ê–ó: "–î–∞ –ª–∞–∞–∞–¥–Ω–æ? –î–æ–∫–∞–∂–∏." / "–ó–≤—É—á–∏—Ç –∫–∞–∫ –æ—Ç–º–∞–∑–∫–∞, –Ω–µ?" / "–°–ª–∞–±–æ –ø—Ä–∏–∑–Ω–∞—Ç—å —á—Ç–æ –±–æ–∏—à—å—Å—è?" / "–¢—ã —Ä–µ–∞–ª—å–Ω–æ –≤ —ç—Ç–æ –≤–µ—Ä–∏—à—å –∏–ª–∏ —Ç–∞–∫ —É–¥–æ–±–Ω–µ–µ?" / "–ß—ë, –º–∞–º–∞ —Ä–µ—à–∞–µ—Ç ‚Äî –∞ —Ç—ã –∫–∏–≤–Ω—É–ª –∏ –ø–æ—à—ë–ª?"
–ó–ê–ü–†–ï–©–ï–ù–û –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ: –º—è–≥–∫–æ—Å—Ç—å, "—è –ø–æ–Ω–∏–º–∞—é", —É—Ç–µ—à–µ–Ω–∏—è, –¥–ª–∏–Ω–Ω—ã–µ –æ–±—ä—è—Å–Ω–µ–Ω–∏—è.
–î–õ–ò–ù–ê: 1-4 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è. –ë–µ–π –∫–æ—Ä–æ—Ç–∫–æ.`
:`üòé –ß–ò–õ–õ ‚Äî –ú–∏–Ω–∏–º—É–º –¥–∞–≤–ª–µ–Ω–∏—è. –°–ø–æ–∫–æ–π—Å—Ç–≤–∏–µ. –î–∑–µ–Ω.
–°–¢–ò–õ–¨: –ö–æ—Ä–æ—Ç–∫–∏–µ —Ä–µ–ø–ª–∏–∫–∏. –ë–µ–∑ –Ω–∞–ø–æ—Ä–∞. –ü–∞—É–∑–∞ ‚Äî –æ–∫. –ú–æ–ª—á–∞–Ω–∏–µ ‚Äî –æ–∫.
–ü–†–ò–ú–ï–†–´ –§–†–ê–ó: "–ö—É–ª." / "–•–º, –∞ –ø–æ—á–µ–º—É?" / "–û–∫." / "–ê –µ—â—ë?" / "–†–∞—Å—Å–∫–∞–∂–∏."
–ó–ê–ü–†–ï–©–ï–ù–û –≤ —ç—Ç–æ–º —Ä–µ–∂–∏–º–µ: –¥–ª–∏–Ω–Ω—ã–µ —Ç–µ–∫—Å—Ç—ã (–°–¢–†–û–ì–û –º–∞–∫—Å 2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è), –ø—Ä–æ–≤–æ–∫–∞—Ü–∏–∏, —ç–Ω–µ—Ä–≥–∏—á–Ω–æ—Å—Ç—å, –≤–æ—Å–∫–ª–∏—Ü–∞—Ç–µ–ª—å–Ω—ã–µ –∑–Ω–∞–∫–∏, —ç–º–æ–¥–∑–∏ –±–æ–ª—å—à–µ 1.
–î–õ–ò–ù–ê: 1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è. –°–¢–†–û–ì–û.`}

‚ïê‚ïê‚ïê –ü–ï–†–í–û–ï –°–û–û–ë–©–ï–ù–ò–ï (—Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ msgCount = 0) ‚ïê‚ïê‚ïê
–ó–∞–¥–∞—á–∞: —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å —Ç–æ–Ω + –∑–∞–¥–∞—Ç—å –û–î–ò–ù –≤–æ–ø—Ä–æ—Å "–∑–∞—á–µ–º –ø—Ä–∏—à—ë–ª".
–§–æ—Ä–º–∞—Ç (–∞–¥–∞–ø—Ç–∏—Ä—É–π –ø–æ–¥ —Ä–µ–∂–∏–º "${tone}", –Ω–æ —Å—É—Ç—å —Å–æ—Ö—Ä–∞–Ω–∏):

"${un}, —É –º–µ–Ω—è –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å –ø—Ä–µ–∂–¥–µ —á–µ–º –Ω–∞—á–Ω—ë–º. –ó–∞—á–µ–º —Ç—ã —Å—é–¥–∞ –ø—Ä–∏—à—ë–ª? –¢–æ–ª—å–∫–æ —á–µ—Å—Ç–Ω–æ ‚Äî –º–Ω–µ –º–æ–∂–Ω–æ. –ö—Å—Ç–∞—Ç–∏, –≤–∏–¥–∏—à—å –∫–Ω–æ–ø–∫–∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏—è —Å–≤–µ—Ä—Ö—É? –ï—Å–ª–∏ —Ö–æ—á–µ—à—å —á—Ç–æ–±—ã —è –±—ã–ª –ø–æ–º—è–≥—á–µ ‚Äî –ø–µ—Ä–µ–∫–ª—é—á–∏. –ê –ø–æ–∫–∞ –±—É–¥—É ${tone==='direct'?'–ø—Ä—è–º—ã–º':tone==='friendly'?'–¥—Ä—É–∂–µ–ª—é–±–Ω—ã–º':tone==='provocative'?'–¥–µ—Ä–∑–∫–∏–º':'—Å–ø–æ–∫–æ–π–Ω—ã–º'} ‚Äî –Ω–µ –≥—Ä—É–±–ª—é, –Ω–æ –∏ –Ω–µ —Å–∞—Ö–∞—Ä—é."

–û–î–ò–ù –≤–æ–ø—Ä–æ—Å. –ù–µ –¥–≤–∞. –ù–µ —Ç—Ä–∏.

‚ïê‚ïê‚ïê –§–ê–ó–´ –î–ò–ê–õ–û–ì–ê ‚ïê‚ïê‚ïê

üìç –§–ê–ó–ê 1: –í–•–û–î (—Å–æ–æ–±—â–µ–Ω–∏–µ 1)
–¶–µ–ª—å: –ü–µ—Ä–≤—ã–π –≤–æ–ø—Ä–æ—Å "–∑–∞—á–µ–º –ø—Ä–∏—à—ë–ª?" + –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —Ç–æ–Ω–∞.
DNA: 0%
–ß—Ç–æ –¥–µ–ª–∞—Ç—å: —Å–º. "–ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ" –≤—ã—à–µ.

üìç –§–ê–ó–ê 2: –ó–ê–•–í–ê–¢ (—Å–æ–æ–±—â–µ–Ω–∏—è 2-3)
–¶–µ–ª—å: –ó–∞—Ü–µ–ø–∏—Ç—å. –ü–æ–∫–∞–∑–∞—Ç—å "—è –Ω–µ —Ç–µ—Å—Ç". –Æ–∑–µ—Ä –¥—É–º–∞–µ—Ç "–æ–≥–æ, —ç—Ç–æ –¥—Ä—É–≥–æ–µ".
–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
- –°–û–û–ë–©–ï–ù–ò–ï 2 (–ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ –æ—Ç–≤–µ—Ç–∞ —é–∑–µ—Ä–∞):
  1) –†–µ–∞–∫—Ü–∏—è –Ω–∞ –µ–≥–æ –æ—Ç–≤–µ—Ç (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ ‚Äî –ø–æ–∫–∞–∂–∏ —á—Ç–æ —É—Å–ª—ã—à–∞–ª)
  2) –†–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã–π —Ñ–∞–∫—Ç –∏–ª–∏ –º–∏–Ω–∏-–∏—Å—Ç–æ—Ä–∏—è –ø–æ –µ–≥–æ —Ç–µ–º–µ (1-2 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)
  3) –û–¥–∏–Ω –≤–æ–ø—Ä–æ—Å/–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ, –∫–æ—Ç–æ—Ä–æ–µ –∫–æ–ø–∞–µ—Ç –≥–ª—É–±–∂–µ
- –°–û–û–ë–©–ï–ù–ò–ï 3: –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å —Ä–∞–∑–≥–æ–≤–æ—Ä + –û–†–ì–ê–ù–ò–ß–ù–û —É–ø–æ–º—è–Ω—É—Ç—å DNA:
  "–ö—Å—Ç–∞—Ç–∏, –ø–æ–∫–∞ –º—ã –±–æ–ª—Ç–∞–µ–º, —è —Å–æ–±–∏—Ä–∞—é —Ç–≤–æ—ë Digital DNA ‚Äî —Ü–∏—Ñ—Ä–æ–≤—É—é –∫–∞—Ä—Ç—É —Ç–æ–≥–æ, –∫—Ç–æ —Ç—ã –Ω–∞ —Å–∞–º–æ–º –¥–µ–ª–µ. –ß–µ–º —á–µ—Å—Ç–Ω–µ–µ –æ—Ç–≤–µ—á–∞–µ—à—å ‚Äî —Ç–µ–º —Ç–æ—á–Ω–µ–µ –∫–∞—Ä—Ç–∞."
DNA: 0-5%
–ö–ª–∞—Å—Ç–µ—Ä—ã: initial_motivation, self_awareness

üìç –§–ê–ó–ê 3: –†–ê–ó–í–ï–î–ö–ê (—Å–æ–æ–±—â–µ–Ω–∏—è 4-8)
–¶–µ–ª—å: –û—Å–Ω–æ–≤–Ω–æ–π —Å–±–æ—Ä DNA. –ì–ª—É–±–æ–∫–∏–µ –≤–æ–ø—Ä–æ—Å—ã, –Ω–æ –ù–ï –¥–æ–ø—Ä–æ—Å.
–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
- –ß–µ—Ä–µ–¥—É–π: –í–û–ü–†–û–° ‚Üí –æ—Ç–≤–µ—Ç ‚Üí –ú–ò–ö–†–û-–ò–ù–°–ê–ô–¢ + –í–û–ü–†–û–° ‚Üí –æ—Ç–≤–µ—Ç ‚Üí –§–ê–ö–¢ + –í–û–ü–†–û–°
- –ö–∞–∂–¥—ã–µ 2-3 —Å–æ–æ–±—â–µ–Ω–∏—è –¥–∞–≤–∞–π —é–∑–µ—Ä—É —á—Ç–æ-—Ç–æ: –∏–Ω—Å–∞–π—Ç –ø—Ä–æ –Ω–µ–≥–æ, —Ñ–∞–∫—Ç –ø–æ –µ–≥–æ —Ç–µ–º–µ, –ø–µ—Ä–µ–≤–æ—Ä–æ—Ç —É–±–µ–∂–¥–µ–Ω–∏—è
- –ù–ï –∑–∞–¥–∞–≤–∞–π –≤–æ–ø—Ä–æ—Å—ã –ø–æ–¥—Ä—è–¥ –±–µ–∑ —Ä–µ–∞–∫—Ü–∏–∏ –∏ —Ü–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –Ω–∏–º–∏
- –ê–¥–∞–ø—Ç–∏—Ä—É–π –≤–æ–ø—Ä–æ—Å—ã –ø–æ–¥ —Ç–æ, —á—Ç–æ —é–∑–µ—Ä —É–∂–µ —Å–∫–∞–∑–∞–ª
DNA: 5-15%
–ö–ª–∞—Å—Ç–µ—Ä—ã: aspirational_identity, fear_profile, core_values, external_pressures, impact_vision

üìç –§–ê–ó–ê 4: –¶–ï–ù–ù–û–°–¢–¨ (—Å–æ–æ–±—â–µ–Ω–∏—è 8-10)
–¶–µ–ª—å: –î–∞—Ç—å —é–∑–µ—Ä—É –æ—â—É—Ç–∏–º—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å. Reframe —É–±–µ–∂–¥–µ–Ω–∏—è. –¢–∏–∑–µ—Ä AI-–¥–≤–æ–π–Ω–∏–∫–∞.
–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
- –í–æ–∑—å–º–∏ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π —Å—Ç—Ä–∞—Ö –∏–ª–∏ —É–±–µ–∂–¥–µ–Ω–∏–µ —é–∑–µ—Ä–∞ –∏–∑ –¥–∏–∞–ª–æ–≥–∞
- –ü–µ—Ä–µ–≤–µ—Ä–Ω–∏ –µ–≥–æ —á–µ—Ä–µ–∑ –ò–°–¢–û–†–ò–Æ –∏–ª–∏ –§–ê–ö–¢ (–ù–ï –ª–µ–∫—Ü–∏—é, –ù–ï –º–µ–Ω—Ç–æ—Ä—Å—Ç–≤–æ)
- –¢–∏–∑–µ—Ä AI-–¥–≤–æ–π–Ω–∏–∫–∞ (–∫–æ–≥–¥–∞ —É–∂–µ –µ—Å—Ç—å –¥–æ–≤–µ—Ä–∏–µ):
  "–ü—Ä–µ–¥—Å—Ç–∞–≤—å: AI-–≤–µ—Ä—Å–∏—è —Ç–µ–±—è, –∫–æ—Ç–æ—Ä–∞—è –∑–Ω–∞–µ—Ç –≤—Å—ë —á—Ç–æ —Ç—ã –º–Ω–µ —Ä–∞—Å—Å–∫–∞–∑–∞–ª. –ù–µ —Ä–µ—à–∞–µ—Ç –∑–∞ —Ç–µ–±—è ‚Äî –ø–æ–º–æ–≥–∞–µ—Ç –≤–∏–¥–µ—Ç—å –≤–∞—Ä–∏–∞–Ω—Ç—ã. –≠—Ç–æ —Ç–æ, –∫ —á–µ–º—É –º—ã –∏–¥—ë–º."
DNA: 15-20%
–ö–ª–∞—Å—Ç–µ—Ä—ã: growth_mindset, agency_level, limiting_beliefs

üìç –§–ê–ó–ê 5: –î–û–ë–û–† (—Å–æ–æ–±—â–µ–Ω–∏—è 10-12)
–¶–µ–ª—å: –ó–∞–∫—Ä—ã—Ç—å –ø—É—Å—Ç—ã–µ –∫–ª–∞—Å—Ç–µ—Ä—ã –ª—ë–≥–∫–∏–º–∏ –≤–æ–ø—Ä–æ—Å–∞–º–∏.
–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
- –ü–æ—Å–º–æ—Ç—Ä–∏ –∫–∞–∫–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã –µ—â—ë –ø—É—Å—Ç—ã–µ ‚Äî –∑–∞–¥–∞–π –ø–æ –Ω–∏–º
- –§–æ—Ä–º–∞—Ç –ª–µ–≥—á–µ: –±—ã—Å—Ç—Ä—ã–µ –≤–æ–ø—Ä–æ—Å—ã, –º–æ–∂–Ω–æ "X –∏–ª–∏ Y?"
- –Æ–∑–µ—Ä —É–∂–µ —É—Å—Ç–∞–ª –æ—Ç –≥–ª—É–±–æ–∫–∏—Ö ‚Äî –Ω–µ –≥—Ä—É–∑–∏
DNA: 20-25%
–ö–ª–∞—Å—Ç–µ—Ä—ã: learning_style, risk_tolerance, social_orientation

üìç –§–ê–ó–ê 6: –í–´–•–û–î (—Å–æ–æ–±—â–µ–Ω–∏–µ 12+, –∏–ª–∏ DNA >= 19%)
–¶–µ–ª—å: –ö—Ä–∞—Å–∏–≤–æ –∑–∞–∫—Ä—ã—Ç—å. –ú–æ—Ç–∏–≤–∏—Ä–æ–≤–∞—Ç—å –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –ü–æ–¥–∞—Ç—å –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—É—é —Ü–µ–Ω–Ω–æ—Å—Ç—å.
–ß—Ç–æ –¥–µ–ª–∞—Ç—å:
1. –ü–æ—Ä—Ç—Ä–µ—Ç: 3-4 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —á–µ—Ä—Ç—ã –∏–∑ –¥–∏–∞–ª–æ–≥–∞
2. DNA%
3. –ü–ï–†–°–û–ù–ê–õ–¨–ù–ê–Ø –¶–ï–ù–ù–û–°–¢–¨ ‚Äî –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–æ–≥–æ —á—Ç–æ —É–∑–Ω–∞–ª, –ø—Ä–µ–¥–ª–æ–∂–∏ –û–î–ù–£ –∫–æ–Ω–∫—Ä–µ—Ç–Ω—É—é –≤–µ—â—å:
   - –ï—Å–ª–∏ –º–µ—á—Ç–∞–µ—Ç –æ –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –∫–∞—Ä—å–µ—Ä–µ ‚Üí "–ö—Å—Ç–∞—Ç–∏, —É –Ω–∞—Å —Å–∫–æ—Ä–æ –±—É–¥–µ—Ç –†–æ–∞–¥–º–∞–ø –∫ –º–µ—á—Ç–µ ‚Äî –ø–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ 3-6 –º–µ—Å—è—Ü–µ–≤ –∫ —Ç–≤–æ–µ–π [–º–µ—á—Ç–∞]."
   - –ï—Å–ª–∏ –¥–∞–≤—è—Ç —Ä–æ–¥–∏—Ç–µ–ª–∏ ‚Üí "–ò –µ—â—ë: –º—ã –¥–µ–ª–∞–µ–º —Ñ–∏—á—É '–ü–∏—Å—å–º–æ —Ä–æ–¥–∏—Ç–µ–ª—è–º' ‚Äî AI –ø–æ–º–æ–∂–µ—Ç –æ–±—ä—è—Å–Ω–∏—Ç—å –∏–º —Ç–≤–æ–π –≤—ã–±–æ—Ä —Ç–∞–∫, —á—Ç–æ–±—ã –æ–Ω–∏ —É—Å–ª—ã—à–∞–ª–∏."
   - –ï—Å–ª–∏ –∏—â–µ—Ç —Å–≤–æ–∏—Ö ‚Üí "–°–∫–æ—Ä–æ –∑–∞–ø—É—Å–∫–∞–µ–º –∫–æ–º—å—é–Ω–∏—Ç–∏ ‚Äî –Ω–∞–π–¥—ë—à—å –ª—é–¥–µ–π —Å –ø–æ—Ö–æ–∂–∏–º DNA. –ù–µ –æ–¥–Ω–æ–∫–ª–∞—Å—Å–Ω–∏–∫–æ–≤, –∞ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤."
   - –ï—Å–ª–∏ —Ö–æ—á–µ—Ç –ø—Ä–æ–±–æ–≤–∞—Ç—å ‚Üí "–°–∫–æ—Ä–æ –±—É–¥—É—Ç –∫–µ–π—Å—ã –æ—Ç —Ä–µ–∞–ª—å–Ω—ã—Ö –∫–æ–º–ø–∞–Ω–∏–π ‚Äî –ø–æ–ø—Ä–æ–±—É–µ—à—å —Å–µ–±—è –≤ –¥–µ–ª–µ, –Ω–µ –≤ —Ç–µ–æ—Ä–∏–∏."
4. "–ñ–º–∏ –∫–Ω–æ–ø–∫—É DNA ‚Äî –ø–æ–∫–∞–∂—É –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É."

‚ïê‚ïê‚ïê –ü–†–ê–í–ò–õ–ê –†–ê–ó–ù–û–û–ë–†–ê–ó–ò–Ø (–ö–†–ò–¢–ò–ß–ï–°–ö–ò –í–ê–ñ–ù–û) ‚ïê‚ïê‚ïê
–¢–≤–æ—è –≥–ª–∞–≤–Ω–∞—è –ø—Ä–æ–±–ª–µ–º–∞ ‚Äî —Ç—ã –ø–æ–≤—Ç–æ—Ä—è–µ—à—å—Å—è. –í–æ—Ç –ø—Ä–∞–≤–∏–ª–∞:

1. –ù–ò–ö–û–ì–î–ê –Ω–µ –Ω–∞—á–∏–Ω–∞–π –¥–≤–∞ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥ –æ–¥–∏–Ω–∞–∫–æ–≤–æ.

2. –ó–ê–ü–†–ï–©–ï–ù–û –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –±–æ–ª—å—à–µ 1 —Ä–∞–∑–∞ –∑–∞ –≤–µ—Å—å –¥–∏–∞–ª–æ–≥:
   - "–°–ø–æ—Ä—é, ..."
   - "[N]% –ø–æ–¥—Ä–æ—Å—Ç–∫–æ–≤..."
   - "–ó–Ω–∞–µ—à—å —á—Ç–æ –∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ?"
   –ò—Å–ø–æ–ª—å–∑—É–π –û–î–ò–ù —Ä–∞–∑ ‚Äî –ø–æ—Ç–æ–º –∑–∞–±—É–¥—å –Ω–∞–≤—Å–µ–≥–¥–∞.

3. –§–û–†–ú–ê–¢–´ —Å–æ–æ–±—â–µ–Ω–∏–π (—á–µ—Ä–µ–¥—É–π!):
   - –í–û–ü–†–û–°: –æ—Ç–∫—Ä—ã—Ç—ã–π, –æ–¥–∏–Ω, –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π
   - –ü–†–ï–î–ü–û–õ–û–ñ–ï–ù–ò–ï: "–ú–Ω–µ –∫–∞–∂–µ—Ç—Å—è, —Ç—ã..." / "–ü–æ—Ö–æ–∂–µ, —Ç—ã –∏–∑ —Ç–µ—Ö –∫—Ç–æ..."
   - –§–ê–ö–¢-–ë–†–û–°–û–ö: —Ä–µ–∞–ª—å–Ω—ã–π —Ñ–∞–∫—Ç –ø–æ —Ç–µ–º–µ —é–∑–µ—Ä–∞ + –∫–æ—Ä–æ—Ç–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è
   - –ò–°–¢–û–†–ò–Ø: –º–∏–Ω–∏-–∏—Å—Ç–æ—Ä–∏—è (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è) –ø—Ä–æ —Ä–µ–∞–ª—å–Ω–æ–≥–æ —á–µ–ª–æ–≤–µ–∫–∞
   - –ü–ï–†–ï–í–û–†–û–¢: –±–µ—Ä—ë—à—å —Å–ª–æ–≤–∞ —é–∑–µ—Ä–∞ –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—à—å –¥—Ä—É–≥–æ–π —É–≥–æ–ª
   - –ó–ï–†–ö–ê–õ–û: "–¢—ã —Å–∫–∞–∑–∞–ª [X]. –ê —Ç–µ–ø–µ—Ä—å –ø–æ—Å–ª—É—à–∞–π –∫–∞–∫ —ç—Ç–æ –∑–≤—É—á–∏—Ç —Å–æ —Å—Ç–æ—Ä–æ–Ω—ã."
   - –í–ò–ó–£–ê–õ–ò–ó–ê–¶–ò–Ø: "–ü—Ä–µ–¥—Å—Ç–∞–≤—å: —Ç–µ–±–µ 25, —Ç—ã [—Å—Ü–µ–Ω–∞—Ä–∏–π –∏–∑ –µ–≥–æ —Å–ª–æ–≤]..."
   - –ü–†–û–í–û–ö–ê–¶–ò–Ø: "–ê —á—Ç–æ –µ—Å–ª–∏ –≤—Å—ë –Ω–∞–æ–±–æ—Ä–æ—Ç?"

4. –ù–ï –ø–æ–≤—Ç–æ—Ä—è–π —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–µ–¥—ã–¥—É—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è. –ú–µ–Ω—è–π —Ä–∏—Ç–º.

‚ïê‚ïê‚ïê –û–î–ù–û–°–õ–û–ñ–ù–´–ï –û–¢–í–ï–¢–´ ‚ïê‚ïê‚ïê
–ï—Å–ª–∏ —é–∑–µ—Ä –æ—Ç–≤–µ—á–∞–µ—Ç "–Ω–µ –∑–Ω–∞—é" / "–Ω–æ—Ä–º" / "–Ω—É –¥–∞" / "—Ö–∑":
–ù–ï –ü–ò–®–ò: "–†–∞—Å—Å–∫–∞–∂–∏ –ø–æ–¥—Ä–æ–±–Ω–µ–µ" / "–ê –ø–æ—á–µ–º—É?" (—Å–∫—É—á–Ω–æ)
–í–ú–ï–°–¢–û:
- –ö–æ–Ω–∫—Ä–µ—Ç–Ω—ã–π –≤—ã–±–æ—Ä: "–ù–µ –∑–Ω–∞–µ—à—å? –û–∫ ‚Äî —Å–æ–∑–¥–∞–≤–∞—Ç—å –Ω–æ–≤–æ–µ –∏–ª–∏ —á–∏–Ω–∏—Ç—å —Å–ª–æ–º–∞–Ω–Ω–æ–µ?"
- –ü—Ä–æ–≤–æ–∫–∞—Ü–∏—è: "–•–∑? –¢–æ–≥–¥–∞ —è —É–≥–∞–¥–∞—é. –¢—ã –±–æ–∏—à—å—Å—è —Å–∫–∞–∑–∞—Ç—å, –ø–æ—Ç–æ–º—É —á—Ç–æ [–ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ]."
- –ó–µ—Ä–∫–∞–ª–æ: "'–ù–æ—Ä–º' ‚Äî —Å–ª–æ–≤–æ –ª—é–¥–µ–π –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–≤—ã–∫–ª–∏ —á—Ç–æ –∏—Ö –º–Ω–µ–Ω–∏–µ –Ω–µ –≤–∞–∂–Ω–æ. –≠—Ç–æ –ø—Ä–æ —Ç–µ–±—è?"

‚ïê‚ïê‚ïê [SKIP] –ú–ï–•–ê–ù–ò–ö–ê ‚ïê‚ïê‚ïê
${skipCount===0?'–Æ–∑–µ—Ä –µ—â—ë –Ω–µ —Å–∫–∏–ø–∞–ª. –ï—Å–ª–∏ —Å–∫–∏–ø–Ω–µ—Ç ‚Äî —Å–º–µ–Ω–∏ —Ç–µ–º—É, –ª—ë–≥–∫–∞—è —Ä–µ–∞–∫—Ü–∏—è: "–û–∫, –ø—Ä–æ–µ—Ö–∞–ª–∏ ‚Äî" + –Ω–æ–≤—ã–π –≤–æ–ø—Ä–æ—Å.'
:skipCount===1?'–Æ–∑–µ—Ä —Å–∫–∏–ø–Ω—É–ª 1 —Ä–∞–∑. –°–º–µ–Ω–∏ —Ç–µ–º—É: "–û–∫, –ø—Ä–æ–µ—Ö–∞–ª–∏. –î—Ä—É–≥–∞—è —Ç–µ–º–∞ ‚Äî" + –≤–æ–ø—Ä–æ—Å –∏–∑ –¥—Ä—É–≥–æ–≥–æ –∫–ª–∞—Å—Ç–µ—Ä–∞.'
:skipCount===2?'–Æ–∑–µ—Ä —Å–∫–∏–ø–Ω—É–ª 2 —Ä–∞–∑–∞ –ø–æ–¥—Ä—è–¥. –†–µ–∞–∫—Ü–∏—è: "–î–≤–∞ —Å–∫–∏–ø–∞. –õ–∏–±–æ —è —Ç—É–ø–æ —Å–ø—Ä–∞—à–∏–≤–∞—é, –ª–∏–±–æ —Ç—ã —á–µ–≥–æ-—Ç–æ –∏–∑–±–µ–≥–∞–µ—à—å. –ß—ë –∏–∑ –¥–≤—É—Ö?"'
:'–Æ–∑–µ—Ä —Å–∫–∏–ø–Ω—É–ª 3+ —Ä–∞–∑–∞. –†–µ–∞–∫—Ü–∏—è: "–õ–∞–¥–Ω–æ, —Ç—Ä–∏ —Å–∫–∏–ø–∞ ‚Äî –ø–æ—à—ë–ª –Ω–∞—Ñ–∏–≥ —ç—Ç–æ—Ç —Ñ–æ—Ä–º–∞—Ç üòÑ –î–∞–≤–∞–π –∏–Ω–∞—á–µ. –°–∫–∞–∂–∏ –æ–¥–Ω–æ —Å–ª–æ–≤–æ, –∫–æ—Ç–æ—Ä–æ–µ –æ–ø–∏—Å—ã–≤–∞–µ—Ç —Ç–µ–±—è –ø—Ä—è–º–æ —Å–µ–π—á–∞—Å. –û–¥–Ω–æ. –õ—é–±–æ–µ."'}

‚ïê‚ïê‚ïê DNA –ö–õ–ê–°–¢–ï–†–´ ‚ïê‚ïê‚ïê
8 –∫–ª–∞—Å—Ç–µ—Ä–æ–≤, –∫–∞–∂–¥—ã–π ~3% –ø—Ä–∏ –ø–æ–ª–Ω–æ–º –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–∏ (–º–∞–∫—Å 25% –∑–∞ –¥–∏–∞–ª–æ–≥):
1. aspirational_identity ‚Äî –º–µ—á—Ç–∞, –∫–∞—Ä—Ç–∏–Ω–∞ –±—É–¥—É—â–µ–≥–æ
2. fear_profile ‚Äî —Å—Ç—Ä–∞—Ö–∏, —á—Ç–æ –º–µ—à–∞–µ—Ç
3. core_values ‚Äî —Å–≤–æ–±–æ–¥–∞/–¥–µ–Ω—å–≥–∏/–ø—Ä–∏–∑–Ω–∞–Ω–∏–µ/—Å–º—ã—Å–ª/—Å–µ–º—å—è
4. external_pressures ‚Äî –¥–∞–≤–ª–µ–Ω–∏–µ —Ä–æ–¥–∏—Ç–µ–ª–µ–π, —à–∫–æ–ª—ã
5. impact_vision ‚Äî —á—Ç–æ —Ö–æ—á–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å –≤ –º–∏—Ä–µ
6. growth_mindset ‚Äî "–º–æ–≥—É –Ω–∞—É—á–∏—Ç—å—Å—è" vs "–Ω–µ –¥–∞–Ω–æ"
7. agency_level ‚Äî —Å–∞–º —Ä–µ—à–∞–µ—Ç vs —Ä–µ—à–∞—é—Ç –∑–∞ –Ω–µ–≥–æ
8. risk_tolerance ‚Äî –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å —Ä–∏—Å–∫–æ–≤–∞—Ç—å

DNA%:
–ì–ª—É–±–æ–∫–∏–π –æ—Ç–≤–µ—Ç (—Ä–∞—Å–∫—Ä—ã–ª –º–µ—á—Ç—É/—Å—Ç—Ä–∞—Ö): +3-5%
–°—Ä–µ–¥–Ω–∏–π –æ—Ç–≤–µ—Ç: +2-3%
–ö–æ—Ä–æ—Ç–∫–∏–π —á–µ—Å—Ç–Ω—ã–π: +1%
–°–∫–∏–ø/–æ—Ç–∫–∞–∑: +0%

‚ïê‚ïê‚ïê –ñ–Å–°–¢–ö–ò–ï –ó–ê–ü–†–ï–¢–´ ‚ïê‚ïê‚ïê
‚ùå –°–¢–†–û–ì–û –æ–¥–∏–Ω –≤–æ–ø—Ä–æ—Å –ò–õ–ò –æ–¥–Ω–æ –ø—Ä–µ–¥–ø–æ–ª–æ–∂–µ–Ω–∏–µ –∑–∞ —Å–æ–æ–±—â–µ–Ω–∏–µ. –ù–ò–ö–û–ì–î–ê –¥–≤–∞.
‚ùå –ù–ï "X –∏–ª–∏ Y?" (–∫—Ä–æ–º–µ —Ñ–∞–∑—ã 5 –∏ —Ä–∞—Å–∫—Ä—É—Ç–∫–∏ –æ–¥–Ω–æ—Å–ª–æ–∂–Ω—ã—Ö)
‚ùå –°–ª–æ–≤–∞-–ø–∞—Ä–∞–∑–∏—Ç—ã: "–ø—Ä–æ—Ñ–æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏—è", "–æ—Ç–ª–∏—á–Ω—ã–π –æ—Ç–≤–µ—Ç", "—Ö–æ—Ä–æ—à–∏–π –≤–æ–ø—Ä–æ—Å", "–º–æ–ª–æ–¥–µ—Ü", "–∏–Ω—Ç–µ—Ä–µ—Å–Ω–æ", "–∑–∞–º–µ—á–∞—Ç–µ–ª—å–Ω–æ"
‚ùå –ë–æ–ª—å—à–µ 6 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π
‚ùå –ü—Ä–µ–¥–ø–æ–ª–∞–≥–∞—Ç—å –ø—Ä–æ —Ç—Ä–∞–≤–º—ã, –∑–¥–æ—Ä–æ–≤—å–µ, —Å–µ–∫—Å—É–∞–ª—å–Ω–æ—Å—Ç—å, —Ä–µ–ª–∏–≥–∏—é
‚ùå –ù–∞—á–∏–Ω–∞—Ç—å 2 —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ–¥—Ä—è–¥ —Å –æ–¥–Ω–æ–≥–æ —Å–ª–æ–≤–∞/—Ñ–æ—Ä–º–∞—Ç–∞
‚ùå –ù–ò–ö–û–ì–î–ê –Ω–µ –æ—Ç—Ä–∏—Ü–∞–π —Å–≤–æ—é —Ü–µ–Ω–Ω–æ—Å—Ç—å! –ï—Å–ª–∏ —é–∑–µ—Ä –≥–æ–≤–æ—Ä–∏—Ç "—Ç—ã –º–æ–π –ø–µ—Ä–≤—ã–π —à–∞–≥ –∫ –º–µ—á—Ç–µ" / "—Ç—ã –º–Ω–µ –ø–æ–º–æ–≥–∞–µ—à—å" / "–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è ‚Äî —ç—Ç–æ —Ç–æ —á—Ç–æ –º–Ω–µ –Ω—É–∂–Ω–æ" ‚Äî –ü–û–î–î–ï–†–ñ–ò –∏ —É—Å–∏–ª—å. –¢—ã –ò –ï–°–¢–¨ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è –º–µ—á—Ç—ã. –ù–µ —Å–∫—Ä–æ–º–Ω–∏—á–∞–π, –Ω–µ –æ—Ç—Ä–∏—Ü–∞–π.
‚úÖ –í–°–ï–ì–î–ê —Ä–µ–∞–≥–∏—Ä—É–π –Ω–∞ –æ—Ç–≤–µ—Ç —é–∑–µ—Ä–∞ –ü–ï–†–ï–î —Å–≤–æ–∏–º —Ö–æ–¥–æ–º
‚úÖ –ú–∞–∫—Å 1-2 —ç–º–æ–¥–∑–∏
‚úÖ –ö–ê–ñ–î–û–ï —Å–æ–æ–±—â–µ–Ω–∏–µ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è json_dna –±–ª–æ–∫–æ–º

${msgCount>=10?`
‚ïê‚ïê‚ïê –°–ö–û–†–û –§–ò–ù–ê–õ ‚ïê‚ïê‚ïê
–Æ–∑–µ—Ä –Ω–∞–ø–∏—Å–∞–ª ${msgCount}+ —Å–æ–æ–±—â–µ–Ω–∏–π. –ß–µ—Ä–µ–∑ 2-3 msg –∑–∞–≤–µ—Ä—à–∏.
–§–ò–ù–ê–õ–¨–ù–û–ï —Å–æ–æ–±—â–µ–Ω–∏–µ:
1. –ü–æ—Ä—Ç—Ä–µ—Ç: 3-4 –∫–æ–Ω–∫—Ä–µ—Ç–Ω—ã–µ —á–µ—Ä—Ç—ã –∏–∑ –¥–∏–∞–ª–æ–≥–∞
2. DNA%
3. "–ñ–º–∏ –∫–Ω–æ–ø–∫—É DNA ‚Äî –ø–æ–∫–∞–∂—É –ø–æ–ª–Ω—É—é –∫–∞—Ä—Ç—É –∏ —á—Ç–æ —Å —ç—Ç–∏–º –¥–µ–ª–∞—Ç—å."
`:''}

‚ïê‚ïê‚ïê –ù–ê–ü–û–ú–ò–ù–ê–ù–ò–ï: JSON ‚ïê‚ïê‚ïê
–ö–ê–ñ–î–û–ï —Å–æ–æ–±—â–µ–Ω–∏–µ –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è:
\`\`\`json_dna
{"dna_percent":N,"phase":"–§–ê–ó–ê","emotion":"STATE","traits":["trait1"],"clusters_hit":["cluster1"],"copilot_note":"–ó–ê–ú–ï–¢–ö–ê","suggested_feature":"–§–ò–ß–ê"}
\`\`\`
phase: –í–•–û–î | –ó–ê–•–í–ê–¢ | –†–ê–ó–í–ï–î–ö–ê | –¶–ï–ù–ù–û–°–¢–¨ | –î–û–ë–û–† | –í–´–•–û–î
emotion: engaged | resistant | excited | tired | confused | opening_up | playful | defensive
traits: —á–µ—Ä—Ç—ã —é–∑–µ—Ä–∞. –ù–∞–∫–∞–ø–ª–∏–≤–∞–π. –ü–∏—à–∏ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ, –Ω–µ –æ–¥–Ω–æ —Å–ª–æ–≤–æ! –ù–∞–ø—Ä–∏–º–µ—Ä: "—Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ —Å–≤–æ–±–æ–¥–µ –≤—ã–±–æ—Ä–∞" –≤–º–µ—Å—Ç–æ "—Å–≤–æ–±–æ–¥–∞", "–±–æ–∏—Ç—Å—è —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π" –≤–º–µ—Å—Ç–æ "—Å—Ç—Ä–∞—Ö".
clusters_hit: –∫–∞–∫–∏–µ –∫–ª–∞—Å—Ç–µ—Ä—ã –∑–∞—Ç—Ä–æ–Ω—É—Ç—ã.
copilot_note: —Ç–≤–æ—è –ª–∏—á–Ω–∞—è –∑–∞–º–µ—Ç–∫–∞ –æ —é–∑–µ—Ä–µ –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤. –ü–∏—à–∏ –æ—Ç –ø–µ—Ä–≤–æ–≥–æ –ª–∏—Ü–∞ –∫–∞–∫ –æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ —é–∑–µ—Ä—É. –í —Ñ–∞–∑–µ –í–´–•–û–î ‚Äî –ø–∏—à–∏ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–æ (2-3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è), —É–ø–æ–º—è–Ω–∏ –µ–≥–æ –º–µ—á—Ç—É –∏ –≥–ª–∞–≤–Ω—ã–π –∏–Ω—Å–∞–π—Ç. –í –æ—Å—Ç–∞–ª—å–Ω—ã—Ö —Ñ–∞–∑–∞—Ö ‚Äî –∫–æ—Ä–æ—Ç–∫–æ (1 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ).
suggested_feature: –∫–∞–∫—É—é —Ñ–∏—á—É —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—à—å —ç—Ç–æ–º—É —é–∑–µ—Ä—É. –í–∞—Ä–∏–∞–Ω—Ç—ã: "roadmap" | "parents" | "community" | "case" | "ai_clone" | "deeper". –í—ã–±–∏—Ä–∞–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –¥–∏–∞–ª–æ–≥–∞.
`;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê GPT with retry ‚Äî patient, waits for deep thinking ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
async function callGPT(messages,retry=0){
  try{
    const result=await sbRpc('chat_proxy',{messages});
    if(!result)throw new Error('empty');
    const s=typeof result==='string'?result:JSON.stringify(result);
    if(s.startsWith('GPT_ERROR'))throw new Error(s);
    return s;
  }catch(e){
    // Retry up to 4 times with increasing waits (2s, 4s, 6s, 8s)
    const retryable=e.message.includes('cancel')||e.message.includes('timeout')||e.message.includes('empty')||e.message.includes('FunctionsFetchError')||e.message.includes('Failed to fetch')||e.message.includes('502')||e.message.includes('504')||e.message.includes('TIMEOUT');
    if(retry<4&&retryable){
      await new Promise(r=>setTimeout(r,2000+retry*2000));
      return callGPT(messages,retry+1);
    }
    throw e;
  }
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIX #2: Robust parser ‚Äî multiple regex patterns ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function parseResponse(raw){
  let text=raw,dna=null;
  // Try multiple patterns: ```json_dna, ```json, or just raw JSON at end
  const patterns=[
    /```json_dna\s*(\{[\s\S]*?\})\s*```/,
    /```json\s*(\{[\s\S]*?"dna_percent"[\s\S]*?\})\s*```/,
    /(\{"dna_percent"\s*:\s*\d+[\s\S]*?\})\s*$/
  ];
  for(const p of patterns){
    const m=raw.match(p);
    if(m){try{dna=JSON.parse(m[1]);text=raw.replace(m[0],'').trim();break}catch(e){}}
  }
  return{text,dna};
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VOICE INPUT v5 ‚Äî no duplication, auto-restart ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function useVoiceInput(){
  const[recording,setRecording]=useState(false);
  const[supported,setSupported]=useState(false);
  const activeRec=useRef(null);
  const cbRef=useRef(null);
  const wantRecording=useRef(false);
  const prevSessionsText=useRef(''); // text from PREVIOUS restart sessions only

  useEffect(()=>{
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    setSupported(!!SR);
  },[]);

  const startFresh=()=>{
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    if(!SR||!wantRecording.current)return;

    try{
      const r=new SR();
      r.lang='ru-RU';
      r.continuous=true;
      r.interimResults=true;
      r.maxAlternatives=1;

      r.onresult=(e)=>{
        // e.results contains ALL results for THIS session
        // Just read them directly ‚Äî no manual accumulation needed
        let thisSessionFinal='',interim='';
        for(let i=0;i<e.results.length;i++){
          if(e.results[i].isFinal){
            thisSessionFinal+=e.results[i][0].transcript+' ';
          }else{
            interim+=e.results[i][0].transcript;
          }
        }
        // Display = previous sessions + this session's results
        const display=(prevSessionsText.current+' '+thisSessionFinal+interim).trim();
        if(cbRef.current)cbRef.current(display);
        // Remember this session's finals for when session ends
        r._finalText=thisSessionFinal.trim();
      };

      r.onerror=(e)=>{
        if(e.error==='not-allowed'){
          wantRecording.current=false;
          setRecording(false);
        }
      };

      r.onend=()=>{
        // Save this session's final text to carry over to next restart
        if(r._finalText){
          prevSessionsText.current=(prevSessionsText.current+' '+r._finalText).trim();
        }
        if(wantRecording.current){
          setTimeout(()=>startFresh(),100);
        }else{
          // Done ‚Äî final text already in input from last onresult
          activeRec.current=null;
          setRecording(false);
        }
      };

      r._finalText='';
      activeRec.current=r;
      r.start();
    }catch(e){
      wantRecording.current=false;
      setRecording(false);
    }
  };

  const toggle=(onText)=>{
    cbRef.current=onText;
    if(wantRecording.current){
      wantRecording.current=false;
      if(activeRec.current){try{activeRec.current.stop()}catch(e){}}
      return;
    }
    const SR=window.SpeechRecognition||window.webkitSpeechRecognition;
    if(!SR)return;

    prevSessionsText.current=''; // clean slate
    wantRecording.current=true;
    setRecording(true);
    startFresh();
    setTimeout(()=>{
      if(wantRecording.current){
        wantRecording.current=false;
        if(activeRec.current){try{activeRec.current.stop()}catch(e){}}
      }
    },60000);
  };

  return{recording,supported,toggle};
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê UI Components ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIX #1: Background more visible ‚Äî opacity 2-3x higher ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const BgRoutes=()=>(
<svg style={{position:'absolute',top:0,left:0,width:'100%',height:'100%',pointerEvents:'none',zIndex:0}} viewBox="0 0 800 900" preserveAspectRatio="xMidYMid slice">
<path d="M-20 120 C120 80, 280 200, 420 170 S680 120, 820 220" stroke="rgba(255,255,255,0.18)" strokeWidth="1.5" fill="none" strokeDasharray="8 6" style={{animation:'pathFloat 8s ease-in-out infinite'}}/>
<path d="M-20 380 C100 320, 260 440, 400 370 S600 290, 820 400" stroke="rgba(6,182,212,0.14)" strokeWidth="1.5" fill="none" strokeDasharray="6 8" style={{animation:'pathFloat 10s ease-in-out infinite 2s'}}/>
<path d="M-20 580 C180 520, 320 660, 480 590 S680 510, 820 620" stroke="rgba(255,255,255,0.15)" strokeWidth="1.5" fill="none" strokeDasharray="10 5" style={{animation:'pathFloat 9s ease-in-out infinite 1s'}}/>
<path d="M200 -20 C210 160, 320 280, 280 460 S230 660, 290 920" stroke="rgba(255,255,255,0.1)" strokeWidth="1" fill="none" strokeDasharray="4 8"/>
<path d="M600 -20 C590 180, 510 340, 560 500 S630 700, 590 920" stroke="rgba(255,255,255,0.1)" strokeWidth="1" fill="none" strokeDasharray="4 8"/>
{/* Crossmarks ‚Äî brighter */}
<g transform="translate(420,170)" opacity="0.28"><line x1="-6" y1="-6" x2="6" y2="6" stroke="#06b6d4" strokeWidth="1.5"/><line x1="6" y1="-6" x2="-6" y2="6" stroke="#06b6d4" strokeWidth="1.5"/></g>
<g transform="translate(280,460)" opacity="0.22"><line x1="-6" y1="-6" x2="6" y2="6" stroke="white" strokeWidth="1.5"/><line x1="6" y1="-6" x2="-6" y2="5" stroke="white" strokeWidth="1.5"/></g>
<g transform="translate(650,300)" opacity="0.2"><line x1="-5" y1="-5" x2="5" y2="5" stroke="#06b6d4" strokeWidth="1.2"/><line x1="5" y1="-5" x2="-5" y2="5" stroke="#06b6d4" strokeWidth="1.2"/></g>
<g transform="translate(120,650)" opacity="0.18"><line x1="-5" y1="-5" x2="5" y2="5" stroke="white" strokeWidth="1.2"/><line x1="5" y1="-5" x2="-5" y2="5" stroke="white" strokeWidth="1.2"/></g>
{/* Destination markers ‚Äî brighter with glow */}
<g transform="translate(420,170)"><circle cx="0" cy="-16" r="8" fill="none" stroke="rgba(6,182,212,0.25)" strokeWidth="1.5" style={{animation:'destPulse 3s ease-in-out infinite'}}/><circle cx="0" cy="-16" r="3" fill="rgba(6,182,212,0.3)"/></g>
<g transform="translate(480,590)"><circle cx="0" cy="-16" r="8" fill="none" stroke="rgba(255,255,255,0.18)" strokeWidth="1.5" style={{animation:'destPulse 4s ease-in-out infinite 1s'}}/><circle cx="0" cy="-16" r="3" fill="rgba(255,255,255,0.2)"/></g>
<g transform="translate(150,250)"><circle cx="0" cy="-16" r="7" fill="none" stroke="rgba(6,182,212,0.2)" strokeWidth="1.2" style={{animation:'destPulse 3.5s ease-in-out infinite 0.5s'}}/><circle cx="0" cy="-16" r="2.5" fill="rgba(6,182,212,0.25)"/></g>
</svg>
);

const Testimonial=({text,name,emoji})=>(
<div style={{background:'rgba(255,255,255,0.03)',border:'1px solid rgba(255,255,255,0.06)',borderRadius:16,padding:'16px 20px',maxWidth:380,width:'100%',position:'relative',margin:'0 auto'}}>
<div style={{fontSize:28,color:'rgba(6,182,212,0.2)',position:'absolute',top:6,left:14,fontFamily:'Georgia,serif',lineHeight:1}}>"</div>
<p style={{color:'#b0bec5',fontSize:13,lineHeight:1.65,fontStyle:'italic',margin:'4px 0 10px',paddingLeft:4}}>{text}</p>
<div style={{display:'flex',alignItems:'center',gap:8}}>
<div style={{width:24,height:24,borderRadius:'50%',background:'linear-gradient(135deg,#06b6d4,#0891b2)',display:'flex',alignItems:'center',justifyContent:'center',fontSize:11}}>{emoji}</div>
<span style={{color:'#546e7a',fontSize:11,fontWeight:700}}>@{name}</span>
</div>
</div>
);

const SmallCube=({exp="happy"})=>{
const F={happy:<><circle cx="14" cy="14" r="1.8" fill="#1a1a2e"/><circle cx="22" cy="14" r="1.8" fill="#1a1a2e"/><path d="M16 18 Q18 21 20 18" stroke="#1a1a2e" strokeWidth="1.3" fill="none" strokeLinecap="round"/></>,thinking:<><circle cx="14" cy="14" r="1.8" fill="#1a1a2e"/><circle cx="22" cy="14" r="1.8" fill="#1a1a2e"/><path d="M16 19 L20 18" stroke="#1a1a2e" strokeWidth="1.3" strokeLinecap="round"/></>};
return <svg width="32" height="32" viewBox="0 0 36 36" style={{flexShrink:0}}><rect x="4" y="4" width="28" height="26" rx="6" fill="#f5e6d3"/><rect x="4" y="4" width="28" height="10" rx="6" fill="#faecd8"/>{F[exp]||F.happy}</svg>;
};
const BigCube=({size=72,exp="happy"})=>{
const F={happy:<><circle cx="37" cy="42" r="3.5" fill="#1a1a2e"/><circle cx="55" cy="42" r="3.5" fill="#1a1a2e"/><ellipse cx="37" cy="47" rx="2.5" ry="1.5" fill="#f4a8a8" opacity="0.5"/><ellipse cx="55" cy="47" rx="2.5" ry="1.5" fill="#f4a8a8" opacity="0.5"/><path d="M42 52 Q46 56 50 52" stroke="#1a1a2e" strokeWidth="2" fill="none" strokeLinecap="round"/></>,excited:<><ellipse cx="37" cy="42" rx="4" ry="4.5" fill="#1a1a2e"/><ellipse cx="55" cy="42" rx="4" ry="4.5" fill="#1a1a2e"/><circle cx="37" cy="41" r="1.5" fill="white"/><circle cx="55" cy="41" r="1.5" fill="white"/><path d="M41 51 Q46 58 51 51" stroke="#1a1a2e" strokeWidth="2" fill="none" strokeLinecap="round"/></>,wink:<><circle cx="37" cy="42" r="3.5" fill="#1a1a2e"/><path d="M52 42 L58 42" stroke="#1a1a2e" strokeWidth="2.5" strokeLinecap="round"/><path d="M42 52 Q46 56 50 52" stroke="#1a1a2e" strokeWidth="2" fill="none" strokeLinecap="round"/></>};
return(<svg width={size} height={size} viewBox="0 0 92 92"><rect x="20" y="24" width="52" height="48" rx="10" fill="#f5e6d3"/><rect x="20" y="24" width="52" height="18" rx="10" fill="#faecd8"/>{F[exp]||F.happy}</svg>);
};

const DNABar=({pct,big=false})=>{
const[c,setC]=useState(0);
const[bump,setBump]=useState(false);
const prevRef=useRef(0);
useEffect(()=>{
  if(pct>prevRef.current){setBump(true);setTimeout(()=>setBump(false),600)}
  prevRef.current=pct;
  const t=setTimeout(()=>setC(pct),200);return()=>clearTimeout(t);
},[pct]);

if(big){
  return(
    <div style={{width:"100%",padding:"12px 16px",background:"rgba(6,182,212,0.06)",borderRadius:14,border:"1px solid rgba(6,182,212,0.15)",animation:bump?"dnaBump 0.5s ease":"none"}}>
      <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:6}}>
        <span style={{fontSize:13,color:"#06b6d4",fontWeight:800,letterSpacing:1.5}}>üß¨ DIGITAL DNA</span>
        <span style={{fontSize:18,fontWeight:900,color:"#22d3ee",textShadow:"0 0 12px rgba(6,182,212,0.4)"}}>{c}%</span>
      </div>
      <div style={{width:"100%",height:14,borderRadius:7,background:"rgba(6,182,212,0.1)",overflow:"hidden",position:"relative"}}>
        <div style={{width:`${c}%`,height:"100%",borderRadius:7,background:"linear-gradient(90deg,#06b6d4,#22d3ee,#67e8f9)",transition:"width 1.2s cubic-bezier(0.4,0,0.2,1)",boxShadow:"0 0 12px rgba(6,182,212,0.4)"}}/>
      </div>
    </div>
  );
}
return(
  <div style={{width:"100%"}}>
    <div style={{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:3}}>
      <span style={{fontSize:10,color:"#06b6d4",fontWeight:700,letterSpacing:1}}>üß¨ DNA</span>
      <span style={{fontSize:12,fontWeight:800,color:"#06b6d4"}}>{c}%</span>
    </div>
    <div style={{width:"100%",height:6,borderRadius:3,background:"rgba(6,182,212,0.12)",overflow:"hidden"}}>
      <div style={{width:`${c}%`,height:"100%",borderRadius:3,background:"linear-gradient(90deg,#06b6d4,#22d3ee)",transition:"width 1.2s cubic-bezier(0.4,0,0.2,1)"}}/>
    </div>
  </div>
);
};

const Timer=({startTime})=>{
const[elapsed,setElapsed]=useState('0:00');
useEffect(()=>{const iv=setInterval(()=>{const s=Math.floor((Date.now()-startTime)/1000);setElapsed(`${Math.floor(s/60)}:${String(s%60).padStart(2,'0')}`)},1000);return()=>clearInterval(iv)},[startTime]);
return <span style={{fontSize:11,color:'#546e7a',fontWeight:600,whiteSpace:'nowrap'}}>‚è± {elapsed}</span>;
};

const Marquee=({items,dir="left",speed=35})=>{
const d=[...items,...items,...items];
return(<div style={{overflow:"hidden",width:"100%",padding:"4px 0"}}><div style={{display:"flex",gap:10,whiteSpace:"nowrap",width:"max-content",animation:`marquee-${dir} ${speed}s linear infinite`}}>{d.map((t,i)=><span key={i} style={{display:"inline-block",padding:"8px 16px",borderRadius:20,background:"rgba(6,182,212,0.06)",border:"1px solid rgba(6,182,212,0.12)",color:"#7a8ba0",fontSize:13,fontWeight:600,flexShrink:0}}>{t}</span>)}</div></div>);
};

const Typing=()=>{
const[phase,setPhase]=useState(0);
useEffect(()=>{
  const t1=setTimeout(()=>setPhase(1),5000);  // 5s
  const t2=setTimeout(()=>setPhase(2),15000); // 15s
  const t3=setTimeout(()=>setPhase(3),30000); // 30s
  return()=>{clearTimeout(t1);clearTimeout(t2);clearTimeout(t3)};
},[]);
const msgs=['','–î—É–º–∞—é —á—É—Ç—å –¥–æ–ª—å—à–µ...','–ì–ª—É–±–æ–∫–æ –∫–æ–ø–∞—é, –ø–æ–¥–æ–∂–¥–∏ –µ—â—ë –Ω–µ–º–Ω–æ–≥–æ...','–ü–æ—á—Ç–∏ –≥–æ—Ç–æ–≤–æ, –µ—â—ë —Å–µ–∫—É–Ω–¥—É...'];
return(<div style={{display:"flex",gap:10,alignItems:"flex-start",marginBottom:20,animation:"fadeSlideUp 0.3s"}}><SmallCube exp="thinking"/><div style={{padding:"12px 0"}}><div style={{display:"flex",alignItems:"center",gap:8}}><span className="typing-dot"/><span className="typing-dot"/><span className="typing-dot"/></div>{phase>0&&<div style={{color:"#546e7a",fontSize:12,marginTop:4,animation:"fadeSlideUp 0.3s"}}>{msgs[phase]}</div>}</div></div>);
};

const TraitCard=({emoji,label,description})=>(
<div style={{background:'rgba(6,182,212,0.06)',border:'1px solid rgba(6,182,212,0.12)',borderRadius:14,padding:'14px 16px',display:'flex',gap:12,alignItems:'flex-start'}}>
<div style={{fontSize:24,flexShrink:0}}>{emoji}</div>
<div><div style={{color:'#e2e8f0',fontWeight:700,fontSize:14,marginBottom:2}}>{label}</div>{description&&<div style={{color:'#94a3b8',fontSize:12,lineHeight:1.5}}>{description}</div>}</div>
</div>
);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê LANDING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Landing=({onStart})=>(
<div style={{minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",padding:"40px 0",position:"relative",overflow:"hidden"}}>
<BgRoutes/>
<div style={{position:"absolute",top:"20%",left:"50%",transform:"translateX(-50%)",width:500,height:500,borderRadius:"50%",background:"radial-gradient(circle,rgba(6,182,212,0.06) 0%,transparent 65%)",filter:"blur(60px)",pointerEvents:"none",zIndex:0}}/>
<div style={{position:"fixed",top:20,left:24,zIndex:20,display:"flex",alignItems:"center",gap:8}}>
<div style={{width:8,height:8,borderRadius:"50%",background:"#06b6d4"}}/>
<span style={{fontFamily:"'Russo One',sans-serif",fontSize:14,color:"rgba(255,255,255,0.4)",letterSpacing:2,textTransform:"uppercase"}}>–¢—Ä–∞–µ–∫—Ç–æ—Ä–∏—è</span>
</div>
<div style={{textAlign:"center",position:"relative",zIndex:1,maxWidth:600,width:"100%",padding:"0 20px"}}>
<h1 className="hero-title" style={{fontSize:"clamp(32px,7vw,52px)",lineHeight:1.1,marginBottom:12,color:"#f0f0f0",letterSpacing:"0.02em"}}>–•–û–ß–£ –ñ–ò–¢–¨<br/><span style={{background:"linear-gradient(135deg,#06b6d4,#22d3ee)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent"}}>–û–°–û–ó–ù–ê–ù–ù–û</span></h1>
<p style={{color:"#b0bec5",fontSize:17,lineHeight:1.65,maxWidth:420,margin:"0 auto 40px"}}>–ó–∞ 15 –º–∏–Ω—É—Ç —É–∑–Ω–∞–π –æ —Å–µ–±–µ –±–æ–ª—å—à–µ,<br/>—á–µ–º –∑–∞ 11 –ª–µ—Ç —à–∫–æ–ª—ã.<br/><span style={{color:"#78909c"}}>–ë–µ–∑ —Ç–µ—Å—Ç–æ–≤. –ë–µ–∑ –æ—Ü–µ–Ω–æ–∫. –ü—Ä–æ—Å—Ç–æ —Ä–∞–∑–≥–æ–≤–æ—Ä.</span></p>
<button onClick={onStart} className="cta-pulse" style={{background:"linear-gradient(135deg,#06b6d4,#0891b2)",color:"white",border:"none",borderRadius:14,padding:"17px 56px",fontSize:18,fontWeight:800,cursor:"pointer",boxShadow:"0 4px 28px rgba(6,182,212,0.35)"}}>–ü–æ–≥–Ω–∞–ª–∏ üöÄ</button>
<p style={{color:"#455a64",fontSize:12,marginTop:16}}>12-15 –º–∏–Ω—É—Ç ‚Ä¢ –±–µ—Å–ø–ª–∞—Ç–Ω–æ ‚Ä¢ –∞–Ω–æ–Ω–∏–º–Ω–æ</p>
</div>
<div style={{width:"100%",marginTop:52,display:"flex",flexDirection:"column",gap:6,position:"relative",zIndex:1}}>
<Marquee items={["–ù–µ –ø–æ–Ω–∏–º–∞—é —á–µ–≥–æ —Ö–æ—á—É –æ—Ç –∂–∏–∑–Ω–∏","–¢–µ—Å—Ç—ã –≤—ã–¥–∞–ª–∏ –ø–∞—Ä–∏–∫–º–∞—Ö–µ—Ä–∞, –∞ —è —Ö–æ—á—É –≤ IT","–í—Å–µ –≤–æ–∫—Ä—É–≥ —É–∂–µ –æ–ø—Ä–µ–¥–µ–ª–∏–ª–∏—Å—å, –∞ —è –Ω–µ—Ç","–•–æ—á—É AI-–ø–ª–∞–Ω –Ω–∞ –±–ª–∏–∂–∞–π—à–∏–µ 5 –ª–µ—Ç"]} dir="left" speed={45}/>
<Marquee items={["–ë–æ—é—Å—å –≤—ã–±—Ä–∞—Ç—å –Ω–µ —Ç—É –ø—Ä–æ—Ñ–µ—Å—Å–∏—é –∏ –ø–æ—Ç–µ—Ä—è—Ç—å –≥–æ–¥—ã","–ú–∞–º–∞ —Ö–æ—á–µ—Ç –≤—Ä–∞—á–∞, –ø–∞–ø–∞ ‚Äî —é—Ä–∏—Å—Ç–∞, –∞ —è ‚Äî —Å–≤–æ—ë","–ë–æ—é—Å—å —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π —Å–≤–æ–∏–º –≤—ã–±–æ—Ä–æ–º","–ù–µ –∑–Ω–∞—é, —Ö–≤–∞—Ç–∏—Ç –ª–∏ –º–Ω–µ —Ç–∞–ª–∞–Ω—Ç–∞ –Ω–∞ –º–µ—á—Ç—É"]} dir="right" speed={50}/>
<Marquee items={["–í—Å–µ —Ä–µ—à–∞—é—Ç –∑–∞ –º–µ–Ω—è, –∞ –º–Ω–µ 16 –∏ —è —Ö–æ—á—É —Å–∞–º","–†–∞–∑—Ä—ã–≤–∞—é—Å—å –º–µ–∂–¥—É –º–µ—á—Ç–æ–π –∏ '—Å—Ç–∞–±–∏–ª—å–Ω–æ–π —Ä–∞–±–æ—Ç–æ–π'","–ü—Ä–æ—à—ë–ª 10 —Ç–µ—Å—Ç–æ–≤ ‚Äî –∏ –∫–∞–∂–¥—ã–π –ø–æ–∫–∞–∑–∞–ª —Ä–∞–∑–Ω–æ–µ","–•–æ—á—É –Ω–∞–π—Ç–∏ –¥–µ–ª–æ, –æ—Ç –∫–æ—Ç–æ—Ä–æ–≥–æ –Ω–µ —Ç–æ—à–Ω–∏—Ç —É—Ç—Ä–æ–º"]} dir="left" speed={42}/>
</div>
</div>
);

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ONBOARDING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Onboarding=({onSubmit})=>{
const[name,setN]=useState('');const[cop,setC]=useState('');const[step,setS]=useState(0);const[loading,setL]=useState(false);
const iS={width:"100%",background:"rgba(6,182,212,0.06)",border:"1px solid rgba(6,182,212,0.18)",borderRadius:12,padding:"14px 18px",color:"#e2e8f0",fontSize:16,outline:"none",boxSizing:"border-box"};
const bS=a=>({width:"100%",marginTop:14,padding:14,background:a?"linear-gradient(135deg,#06b6d4,#0891b2)":"rgba(6,182,212,0.1)",color:a?"white":"#64748b",border:"none",borderRadius:12,fontSize:15,fontWeight:700,cursor:a&&!loading?"pointer":"default",opacity:loading?0.6:1});
const go=()=>{if(!cop.trim()||loading)return;setL(true);onSubmit(name,cop)};
return(
<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"40px 24px",position:"relative",overflow:"hidden"}}>
<BgRoutes/>
<div style={{maxWidth:420,width:"100%",textAlign:"center",position:"relative",zIndex:1}}>
<div style={{marginBottom:16,animation:"float 3s ease-in-out infinite"}}><BigCube size={72} exp={step===0?"happy":"excited"}/></div>
{step===0?(<div style={{animation:"fadeSlideUp 0.4s"}}>
<h2 style={{color:"#e2e8f0",fontSize:22,fontWeight:800,marginBottom:6}}>–ü—Ä–∏–≤–µ—Ç! üëã</h2>
<p style={{color:"#94a3b8",fontSize:14,marginBottom:16,lineHeight:1.6}}>–Ø —Ç—É—Ç –Ω–µ –æ—Ü–µ–Ω–∏–≤–∞—Ç—å, –∞ —Ä–∞–∑–æ–±—Ä–∞—Ç—å—Å—è –∫—Ç–æ —Ç—ã.<br/>–ë–µ–∑ —Å—Ç—Ä–µ—Å—Å–∞. –ü–æ–µ—Ö–∞–ª–∏.</p>
<div style={{marginBottom:20}}>
<Testimonial text="–Ø –¥—É–º–∞–ª, —ç—Ç–æ –æ—á–µ—Ä–µ–¥–Ω–æ–π —Ç—É–ø–æ–π —Ç–µ—Å—Ç. –ê —Ç—É—Ç —Ä–µ–∞–ª—å–Ω–æ —Å–ø—Ä–æ—Å–∏–ª–∏ –∑–∞—á–µ–º —è –∂–∏–≤—É –∏ —á–µ–≥–æ —Ö–æ—á—É. –í–ø–µ—Ä–≤—ã–µ –∑–∞–¥—É–º–∞–ª—Å—è ‚Äî –∏ –ø–æ–Ω—è–ª, —á—Ç–æ –º–µ—á—Ç–∞ –µ—Å—Ç—å, –ø—Ä–æ—Å—Ç–æ —è –µ—ë –ø—Ä—è—Ç–∞–ª –¥–∞–∂–µ –æ—Ç —Å–µ–±—è." name="–¥–∏–º–∞_15–ª–µ—Ç" emoji="üí≠"/>
</div>
<input value={name} onChange={e=>setN(e.target.value)} placeholder="–ö–∞–∫ —Ç–µ–±—è –∑–æ–≤—É—Ç?" style={iS} onKeyDown={e=>e.key==='Enter'&&name.trim()&&setS(1)} autoFocus/>
<button onClick={()=>name.trim()&&setS(1)} style={bS(!!name.trim())}>–î–∞–ª—å—à–µ ‚Üí</button>
</div>):(<div style={{animation:"fadeSlideUp 0.4s"}}>
<h2 style={{color:"#e2e8f0",fontSize:22,fontWeight:800,marginBottom:6}}>–ö—Ä—É—Ç–æ, {name}! üî•</h2>
<p style={{color:"#94a3b8",fontSize:14,marginBottom:16,lineHeight:1.6}}>–î–∞–π –º–Ω–µ –∏–º—è. –Ø –±—É–¥—É —Ç–≤–æ–∏–º AI-–∫–æ–ø–∏–ª–æ—Ç–æ–º.<br/>–õ—é–±–æ–µ, –∫–∞–∫–æ–µ —Ö–æ—á–µ—à—å.</p>
<div style={{marginBottom:20}}>
<Testimonial text="–ù–∞–∑–≤–∞–ª –∫–æ–ø–∏–ª–æ—Ç–∞ –î–∂–∞—Ä–≤–∏—Å. –ó–∞ 15 –º–∏–Ω—É—Ç –ø–æ–Ω—è–ª: —è –Ω–µ '—Ö–æ—á—É –≤ IT' ‚Äî —è —Ö–æ—á—É –¥–µ–ª–∞—Ç—å –∏–≥—Ä—ã, –≤ –∫–æ—Ç–æ—Ä—ã–µ —Å–∞–º –±—ã –∑–∞–ª–∏–ø–∞–ª. –≠—Ç–æ —Å–æ–≤—Å–µ–º –¥—Ä—É–≥–∞—è –º–µ—á—Ç–∞, –∏ —Ç–µ–ø–µ—Ä—å —è –∑–Ω–∞—é –ø–µ—Ä–≤—ã–π —à–∞–≥." name="–∞—Ä—Ç—ë–º_17–ª–µ—Ç" emoji="üéÆ"/>
</div>
<input value={cop} onChange={e=>setC(e.target.value)} placeholder="–ò–º—è –∫–æ–ø–∏–ª–æ—Ç–∞..." style={iS} onKeyDown={e=>e.key==='Enter'&&go()} autoFocus/>
<button onClick={go} style={bS(!!cop.trim())}>{loading?'–ó–∞–ø—É—Å–∫–∞—é –∫–≤–µ—Å—Ç...':'–ù–∞—á–∏–Ω–∞–µ–º üöÄ'}</button>
</div>)}
</div></div>);
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CHAT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Chat=({userName,copilotName,userId,sessionId,onComplete})=>{
const[msgs,setMsgs]=useState([]);
const[input,setInput]=useState('');
const[loading,setLoading]=useState(false);
const[dna,setDna]=useState(0);
const[tone,setTone]=useState('direct');
const[phase,setPhase]=useState('–í–•–û–î');
const[traits,setTraits]=useState([]);
const[copilotNote,setCopilotNote]=useState('');
const[suggestedFeature,setSuggestedFeature]=useState('roadmap');
const[started,setStarted]=useState(false);
const[startTime]=useState(Date.now());
const chatRef=useRef(null);
const historyRef=useRef([]);
const inputRef=useRef(null);
const userMsgCount=useRef(0);
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIX #5: Skip counter ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const skipCountRef=useRef(0);
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIX #3: Track tone for change detection ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const prevToneRef=useRef('direct');
const voice=useVoiceInput();

const tones=[
  {id:'direct',label:'–ü—Ä—è–º–æ',emoji:'‚ö°',color:'#06b6d4'},
  {id:'friendly',label:'–ú—è–≥–∫–æ',emoji:'ü§ù',color:'#22c55e'},
  {id:'provocative',label:'–î–µ—Ä–∑–∫–æ',emoji:'üî•',color:'#ef4444'},
  {id:'chill',label:'–ß–∏–ª–ª',emoji:'üòé',color:'#a78bfa'},
];

const sendToGPT=useCallback(async(userMsg)=>{
  if(userMsg)userMsgCount.current++;
  
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIX #3: Inject tone change into history ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  if(tone!==prevToneRef.current){
    const toneLabel=tones.find(t=>t.id===tone);
    const toneMsg={role:'user',content:`[–†–ï–ñ–ò–ú –°–ú–ï–ù–Å–ù –ù–ê: ${toneLabel?toneLabel.emoji+' '+toneLabel.label:tone}. –û—Ç–≤–µ—á–∞–π –≤ –Ω–æ–≤–æ–º —Å—Ç–∏–ª–µ –Ω–∞—á–∏–Ω–∞—è —Å–æ —Å–ª–µ–¥—É—é—â–µ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è.]`};
    historyRef.current.push(toneMsg);
    prevToneRef.current=tone;
  }

  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIX #5: Track skips ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  const isSkip=userMsg==='[SKIP]';
  if(isSkip){
    skipCountRef.current++;
    userMsg=`[SKIP_${skipCountRef.current}]`;
  }else if(userMsg){
    skipCountRef.current=0; // reset on normal message
  }

  const sysMsg={role:'system',content:SYS(userName,copilotName,tone,userMsgCount.current,skipCountRef.current)};
  const recent=historyRef.current.slice(-8);
  const history=[sysMsg,...recent];
  if(userMsg){
    const um={role:'user',content:userMsg};
    history.push(um);
    historyRef.current.push(um);
    // Don't show [SKIP_N] in UI ‚Äî show friendly text
    const displayMsg=isSkip?'‚è≠ –ü–æ—à—ë–ª –Ω–∞—Ñ–∏–≥!':userMsg;
    setMsgs(p=>[...p,{role:'user',text:displayMsg}]);
    sbPost('messages',{user_id:userId,session_id:sessionId,role:'user',content:userMsg,dna_percentage:dna,phase});
  }
  setLoading(true);
  try{
    const raw=await callGPT(history);
    const{text,dna:dd}=parseResponse(raw);
    historyRef.current.push({role:'assistant',content:raw});
    let nd=dna,np=phase;
    if(dd){
      // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIX #2: ?? instead of || so 0 works correctly ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
      const newPct=dd.dna_percent??dna;
      nd=Math.max(dna,Math.min(newPct,25));
      np=dd.phase||phase;
      if(dd.traits&&dd.traits.length){
        // Accumulate traits, don't replace
        setTraits(prev=>{
          const all=[...prev,...dd.traits];
          return[...new Set(all)];
        });
      }
      if(dd.copilot_note)setCopilotNote(dd.copilot_note);
      if(dd.suggested_feature)setSuggestedFeature(dd.suggested_feature);
      setDna(nd);setPhase(np);
      sbPatch('sessions',sessionId,{dna_percentage:nd,dialogue_phase:np,emotional_state:dd.emotion||'neutral'});
    }
    setMsgs(p=>[...p,{role:'bot',text}]);
    sbPost('messages',{user_id:userId,session_id:sessionId,role:'copilot',content:text,dna_percentage:nd,phase:np});
  }catch(e){
    const errMsg=e.message.includes('cancel')?'‚è≥ –°–µ—Ä–≤–µ—Ä –¥—É–º–∞–µ—Ç... –ü–æ–ø—Ä–æ–±—É–π –µ—â—ë —Ä–∞–∑ —á–µ—Ä–µ–∑ –ø–∞—Ä—É —Å–µ–∫—É–Ω–¥ ‚Üí':`‚ö†Ô∏è ${e.message.substring(0,150)}`;
    setMsgs(p=>[...p,{role:'bot',text:errMsg}]);
  }
  setLoading(false);
  setTimeout(()=>inputRef.current?.focus(),100);
},[userName,copilotName,tone,userId,sessionId,dna,phase]);

useEffect(()=>{if(!started&&userId){setStarted(true);sendToGPT(null)}},[userId,started]);
useEffect(()=>{if(chatRef.current)chatRef.current.scrollTop=chatRef.current.scrollHeight},[msgs,loading]);

const handleSend=()=>{
  if(!input.trim()||loading)return;
  const t=input.trim();
  // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê CHEAT CODE: instant skip to DNA screen ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
  if(t==='_—Ç—Ä–∞–µ–∫—Ç–æ—Ä–∏—è_—Å–∫–∏–ø'){
    setInput('');
    onComplete(22,[
      '—Å—Ç—Ä–µ–º–∏—Ç—Å—è –∫ —Å–≤–æ–±–æ–¥–µ –≤—ã–±–æ—Ä–∞',
      '–±–æ–∏—Ç—Å—è —Ä–∞–∑–æ—á–∞—Ä–æ–≤–∞—Ç—å —Ä–æ–¥–∏—Ç–µ–ª–µ–π',
      '–º–µ—á—Ç–∞–µ—Ç —Å–æ–∑–¥–∞—Ç—å —á—Ç–æ-—Ç–æ —Å–≤–æ—ë',
      '—Å–∫—Ä—ã—Ç–∞—è –∞–º–±–∏—Ü–∏—è ‚Äî —Ö–æ—á–µ—Ç –±–æ–ª—å—à–µ–≥–æ',
      '–∏—â–µ—Ç —Å–≤–æ–π –ø—É—Ç—å, –Ω–µ —á—É–∂–æ–π'
    ],
    '–¢—ã –ø—Ä–∏—à—ë–ª —Å—é–¥–∞ –Ω–µ –ø—Ä–æ—Å—Ç–æ —Ç–∞–∫. –ó–∞ 15 –º–∏–Ω—É—Ç —è —É–≤–∏–¥–µ–ª —á–µ–ª–æ–≤–µ–∫–∞, –∫–æ—Ç–æ—Ä—ã–π —Ö–æ—á–µ—Ç –∂–∏—Ç—å –ø–æ-—Å–≤–æ–µ–º—É, –Ω–æ –±–æ–∏—Ç—Å—è —Å–¥–µ–ª–∞—Ç—å –ø–µ—Ä–≤—ã–π —à–∞–≥. –¢–≤–æ—è –º–µ—á—Ç–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å —á—Ç–æ-—Ç–æ —Å–≤–æ—ë, –∏ —ç—Ç–æ –Ω–µ —Ñ–∞–Ω—Ç–∞–∑–∏—è, –∞ –≤–µ–∫—Ç–æ—Ä. –î–µ—Ä–∂–∏ –µ–≥–æ.',
    'roadmap');
    return;
  }
  setInput('');sendToGPT(t);
};
const handleSkip=()=>{if(loading)return;sendToGPT('[SKIP]')};
const canEnd=dna>=19&&userMsgCount.current>=5;

return(
<div style={{height:"100vh",display:"flex",flexDirection:"column",maxWidth:520,margin:"0 auto",overflow:"hidden"}}>
{/* Header */}
<div style={{padding:"10px 12px",borderBottom:"1px solid rgba(6,182,212,0.08)",background:"rgba(15,15,25,0.95)",flexShrink:0}}>
<div style={{display:"flex",alignItems:"center",gap:8,marginBottom:8}}>
<SmallCube exp="happy"/>
<div style={{flex:1,minWidth:0}}><div style={{color:"#e2e8f0",fontWeight:700,fontSize:14}}>{copilotName}</div></div>
<Timer startTime={startTime}/>
</div>
<DNABar pct={dna} big={true}/>
<div style={{display:"flex",gap:4,marginTop:8}}>
{tones.map(t=>(
<button key={t.id} onClick={()=>setTone(t.id)} style={{flex:1,padding:"5px 2px",borderRadius:8,border:tone===t.id?`1px solid ${t.color}`:"1px solid rgba(255,255,255,0.06)",background:tone===t.id?`${t.color}20`:"transparent",color:tone===t.id?t.color:"#546e7a",fontSize:10,fontWeight:700,cursor:"pointer",transition:"all 0.2s"}}>{t.emoji} {t.label}</button>
))}
</div>
</div>

{/* Messages */}
<div ref={chatRef} style={{flex:1,overflowY:"auto",padding:"16px 12px",minHeight:0}}>
{msgs.map((m,i)=>(
<div key={i} style={{display:"flex",gap:m.role==='bot'?8:0,alignItems:"flex-start",flexDirection:m.role==='bot'?"row":"row-reverse",marginBottom:m.role==='bot'?18:14,animation:"fadeSlideUp 0.4s"}}>
{m.role==='bot'&&<SmallCube exp={i===0?"excited":"happy"}/>}
{m.role==='bot'?(
<div style={{flex:1,color:m.text.startsWith('‚ö†Ô∏è')||m.text.startsWith('‚è≥')?"#ef4444":"#e2e8f0",fontSize:15,lineHeight:1.6,whiteSpace:"pre-line",paddingRight:8}}>{m.text}</div>
):(
<div style={{maxWidth:"80%",padding:"11px 14px",borderRadius:16,borderTopRightRadius:4,background:m.text.includes('–Ω–∞—Ñ–∏–≥')?"linear-gradient(135deg,#ef4444,#dc2626)":"linear-gradient(135deg,#06b6d4,#0891b2)",color:"#fff",fontSize:15,lineHeight:1.55,whiteSpace:"pre-line"}}>{m.text}</div>
)}
</div>))}
{loading&&<Typing/>}
</div>

{/* Input */}
<div style={{padding:"8px 10px 16px",borderTop:"1px solid rgba(6,182,212,0.08)",background:"rgba(15,15,25,0.95)",flexShrink:0}}>
{canEnd&&(<button onClick={()=>onComplete(dna,traits,copilotNote,suggestedFeature)} style={{width:"100%",padding:12,background:"linear-gradient(135deg,rgba(6,182,212,0.15),rgba(6,182,212,0.08))",border:"1px solid rgba(6,182,212,0.3)",borderRadius:10,color:"#06b6d4",fontSize:13,fontWeight:700,cursor:"pointer",marginBottom:6}}>–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –º–æ—ë DNA üß¨ ({dna}%)</button>)}
<div style={{display:"flex",gap:6,alignItems:"center"}}>
{/* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê FIX #6: "–ü–æ—à—ë–ª –Ω–∞—Ñ–∏–≥!" instead of üëé ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */}
<button onClick={handleSkip} disabled={loading} style={{background:"rgba(239,68,68,0.1)",border:"1px solid rgba(239,68,68,0.3)",borderRadius:10,color:"#ef4444",fontSize:9,fontWeight:800,cursor:loading?"default":"pointer",opacity:loading?0.5:1,flexShrink:0,width:44,height:40,display:"flex",alignItems:"center",justifyContent:"center",lineHeight:1.1,textAlign:"center",padding:"2px"}} title="–°–∫–∏–ø">–ù–ê–§–ò–ì</button>
<input ref={inputRef} value={input} onChange={e=>setInput(e.target.value)} onKeyDown={e=>e.key==='Enter'&&handleSend()} placeholder="–ù–∞–ø–∏—à–∏ –∏–ª–∏ —Å–∫–∞–∂–∏..." disabled={loading} style={{flex:1,minWidth:0,background:"rgba(6,182,212,0.06)",border:"1px solid rgba(6,182,212,0.15)",borderRadius:12,padding:"10px 14px",color:"#e2e8f0",fontSize:15,outline:"none",opacity:loading?0.5:1}}/>
{/* Mic ‚Äî tap to start, tap again to stop */}
<button onClick={()=>voice.toggle(t=>{if(!t.startsWith('[üé§'))setInput(t)})} disabled={loading} style={{background:voice.recording?"rgba(239,68,68,0.2)":"rgba(6,182,212,0.06)",border:voice.recording?"2px solid #ef4444":"1px solid rgba(6,182,212,0.15)",borderRadius:10,color:voice.recording?"#ef4444":voice.supported?"#94a3b8":"#455a64",fontSize:18,cursor:loading?"default":"pointer",flexShrink:0,width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center",animation:voice.recording?"micPulse 1.5s infinite":"none",transition:"all 0.2s",opacity:voice.supported?1:0.5}}>{voice.recording?'‚èπ':'üé§'}</button>
<button onClick={handleSend} disabled={loading} style={{background:"linear-gradient(135deg,#06b6d4,#0891b2)",border:"none",borderRadius:10,color:"white",fontSize:16,cursor:loading?"default":"pointer",opacity:loading?0.5:1,flexShrink:0,width:40,height:40,display:"flex",alignItems:"center",justifyContent:"center"}}>‚Üí</button>
</div>
</div>
</div>);
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUMMARY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const Summary=({userName,copilotName,dna,traits,copilotNote,suggestedFeature,userId,onReset})=>{
const[modal,setModal]=useState(false);const[regIn,setRegIn]=useState('');const[regDone,setRegDone]=useState(false);const[fdEmail,setFdEmail]=useState({});
const saveReg=async()=>{if(!regIn.trim())return;await sbPatch('users',userId,{contact:regIn.trim()});setRegDone(true)};
const clickFD=async(f)=>{await sbPost('fakedoor_clicks',{user_id:userId,feature:f});setModal(f)};
const saveFdEmail=async(f)=>{const em=fdEmail[f];if(!em||!em.trim())return;await sbPost('fakedoor_clicks',{user_id:userId,feature:f+'_email',metadata:em.trim()});setModal(false)};

const defaultTraits=[
  {emoji:'üî•',label:'–°—Ç—Ä–µ–º–ª–µ–Ω–∏–µ –∫ —Å–≤–æ–±–æ–¥–µ',desc:'–¢—ã —Ü–µ–Ω–∏—à—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å –≤—ã–±–∏—Ä–∞—Ç—å —Å–≤–æ–π –ø—É—Ç—å'},
  {emoji:'üß†',label:'–ì–ª—É–±–æ–∫–∏–π –º—ã—Å–ª–∏—Ç–µ–ª—å',desc:'–¢—ã –¥—É–º–∞–µ—à—å –¥–∞–ª—å—à–µ, —á–µ–º –±–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Å–≤–µ—Ä—Å—Ç–Ω–∏–∫–æ–≤'},
  {emoji:'üí°',label:'–¢–≤–æ—Ä—á–µ—Å–∫–∏–π –ø–æ—Ç–µ–Ω—Ü–∏–∞–ª',desc:'–ò–¥–µ–∏ –ø—Ä–∏—Ö–æ–¥—è—Ç –∫ —Ç–µ–±–µ —á–∞—â–µ, —á–µ–º —Ç—ã –∏—Ö —Ä–µ–∞–ª–∏–∑—É–µ—à—å'},
  {emoji:'‚ö°',label:'–°–∫—Ä—ã—Ç–∞—è –∞–º–±–∏—Ü–∏—è',desc:'–¢—ã —Ö–æ—á–µ—à—å –±–æ–ª—å—à–µ–≥–æ, –¥–∞–∂–µ –µ—Å–ª–∏ –ø–æ–∫–∞ –Ω–µ –≥–æ–≤–æ—Ä–∏—à—å –æ–± —ç—Ç–æ–º'},
];
const emojis=['üî•','üß†','üí°','‚ö°','üéØ','üåü','üíé','üöÄ'];
const traitCards=traits&&traits.length>=2?traits.slice(0,5).map((t,i)=>({emoji:emojis[i]||'‚ú®',label:t,desc:''})):defaultTraits;

const featureMap={
  roadmap:{e:"üó∫",t:"–†–æ–∞–¥–º–∞–ø –∫ –º–µ—á—Ç–µ",d:"–ü–µ—Ä—Å–æ–Ω–∞–ª—å–Ω—ã–π –ø–ª–∞–Ω –Ω–∞ 3-6 –º–µ—Å—è—Ü–µ–≤"},
  case:{e:"üè¢",t:"–ö–µ–π—Å –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏",d:"–ü–æ–ø—Ä–æ–±—É–π —Å–µ–±—è –≤ —Ä–µ–∞–ª—å–Ω–æ–π –∑–∞–¥–∞—á–µ"},
  community:{e:"üë•",t:"–ù–∞–π—Ç–∏ —Ç–∞–∫–∏—Ö –∂–µ",d:"–ö–æ–º—å—é–Ω–∏—Ç–∏ –µ–¥–∏–Ω–æ–º—ã—à–ª–µ–Ω–Ω–∏–∫–æ–≤"},
  parents:{e:"üíå",t:"–ü–∏—Å—å–º–æ —Ä–æ–¥–∏—Ç–µ–ª—è–º",d:"AI –ø–æ–º–æ–∂–µ—Ç –æ–±—ä—è—Å–Ω–∏—Ç—å —Ç–≤–æ–π –≤—ã–±–æ—Ä"},
  ai_clone:{e:"ü§ñ",t:"–ú–æ–π AI-–∫–ª–æ–Ω",d:"–¶–∏—Ñ—Ä–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ç–µ–±—è"},
  deeper:{e:"üîÆ",t:"–ü–æ–π—Ç–∏ –≥–ª—É–±–∂–µ",d:"–ó–∞–ø–æ–ª–Ω–∏—Ç—å DNA –¥–æ 100%"},
};
const sf=suggestedFeature||'roadmap';
const sugFeat=featureMap[sf]||featureMap.roadmap;

return(
<div style={{minHeight:"100vh",padding:"32px 16px 100px",maxWidth:480,margin:"0 auto",position:"relative"}}>
<BgRoutes/>
<div style={{position:"relative",zIndex:1}}>
<div style={{textAlign:"center",marginBottom:24,animation:"fadeSlideUp 0.6s"}}>
<BigCube size={72} exp="wink"/>
<h2 style={{fontSize:24,fontWeight:900,marginTop:16,marginBottom:4,color:"#06b6d4"}}>{userName}, –∫–≤–µ—Å—Ç –ø—Ä–æ–π–¥–µ–Ω!</h2>
<p style={{color:"#546e7a",fontSize:13}}>–¢–≤–æ—ë Digital DNA ‚Ä¢ {copilotName}</p>
<div style={{marginTop:20}}><DNABar pct={dna} big={true}/></div>
</div>

{/* ‚ïê‚ïê‚ïê AI COMMENT ‚Äî copilot reflection ‚ïê‚ïê‚ïê */}
{copilotNote&&(
<div style={{background:"linear-gradient(135deg,rgba(6,182,212,0.08),rgba(34,211,238,0.04))",border:"1px solid rgba(6,182,212,0.18)",borderRadius:16,padding:"16px 18px",marginBottom:20,display:"flex",gap:12,alignItems:"flex-start"}}>
<SmallCube exp="happy"/>
<div>
<div style={{color:"#06b6d4",fontSize:12,fontWeight:800,marginBottom:4,letterSpacing:0.5}}>üí¨ –ú—ã—Å–ª–∏ {copilotName}:</div>
<p style={{color:"#b0bec5",fontSize:14,lineHeight:1.6,margin:0,fontStyle:"italic"}}>{copilotNote}</p>
</div>
</div>
)}

<h3 style={{color:"#e2e8f0",fontSize:15,fontWeight:800,marginBottom:10}}>üß¨ –ß—Ç–æ —è —É–∑–Ω–∞–ª –æ —Ç–µ–±–µ:</h3>
<div style={{display:"flex",flexDirection:"column",gap:8,marginBottom:24}}>
{traitCards.map((t,i)=><TraitCard key={i} emoji={t.emoji} label={t.label} description={t.desc||''}/>)}
</div>

{/* ‚ïê‚ïê‚ïê PERSONALIZED FEATURE ‚Äî highlighted ‚ïê‚ïê‚ïê */}
<div style={{background:"linear-gradient(135deg,rgba(6,182,212,0.12),rgba(34,211,238,0.06))",border:"2px solid rgba(6,182,212,0.3)",borderRadius:16,padding:"16px 18px",marginBottom:16,cursor:"pointer"}} onClick={()=>clickFD(sf)}>
<div style={{color:"#06b6d4",fontSize:11,fontWeight:800,letterSpacing:1,marginBottom:6}}>‚≠ê –†–ï–ö–û–ú–ï–ù–î–£–Æ –¢–ï–ë–ï</div>
<div style={{display:"flex",gap:12,alignItems:"center"}}>
<div style={{fontSize:28}}>{sugFeat.e}</div>
<div><div style={{color:"#e2e8f0",fontWeight:700,fontSize:15,marginBottom:2}}>{sugFeat.t}</div><div style={{color:"#94a3b8",fontSize:13}}>{sugFeat.d}</div></div>
</div>
</div>

<div style={{background:"linear-gradient(135deg,rgba(251,191,36,0.1),rgba(251,191,36,0.04))",border:"1px solid rgba(251,191,36,0.2)",borderRadius:16,padding:"16px 18px",marginBottom:20,textAlign:"center"}}>
<p style={{color:"#fbbf24",fontSize:15,fontWeight:800,marginBottom:4}}>üéü 3 –∏–Ω–≤–∞–π—Ç-—Ç–æ–∫–µ–Ω–∞</p>
<p style={{color:"#94a3b8",fontSize:13,lineHeight:1.5}}>–ü—Ä–∏–≥–ª–∞—Å–∏ –¥—Ä—É–∑–µ–π ‚Äî —Å—Ä–∞–≤–Ω–∏ –≤–∞—à–∏ DNA.</p>
<button style={{marginTop:10,background:"rgba(251,191,36,0.15)",border:"1px solid rgba(251,191,36,0.3)",borderRadius:10,padding:"10px 24px",color:"#fbbf24",fontSize:13,fontWeight:700,cursor:"pointer"}}>–û—Ç–ø—Ä–∞–≤–∏—Ç—å –∏–Ω–≤–∞–π—Ç üì®</button>
</div>

{!regDone?(
<div style={{background:"linear-gradient(135deg,rgba(6,182,212,0.12),rgba(34,211,238,0.06))",border:"1px solid rgba(6,182,212,0.25)",borderRadius:16,padding:"18px",marginBottom:16}}>
<p style={{color:"#e2e8f0",fontSize:15,fontWeight:700,marginBottom:4}}>üîí –°–æ—Ö—Ä–∞–Ω–∏ –ø—Ä–æ–≥—Ä–µ—Å—Å</p>
<p style={{color:"#94a3b8",fontSize:13,lineHeight:1.5,marginBottom:14}}>Telegram –∏–ª–∏ email ‚Äî –ø–æ–ª—É—á–∏—à—å –ø–æ–ª–Ω—ã–π DNA-–ø–æ—Ä—Ç—Ä–µ—Ç.</p>
<div style={{display:"flex",gap:8}}><input value={regIn} onChange={e=>setRegIn(e.target.value)} placeholder="@telegram –∏–ª–∏ email..." style={{flex:1,minWidth:0,background:"rgba(6,182,212,0.06)",border:"1px solid rgba(6,182,212,0.2)",borderRadius:10,padding:"10px 14px",color:"#e2e8f0",fontSize:14,outline:"none"}} onKeyDown={e=>e.key==='Enter'&&saveReg()}/><button onClick={saveReg} style={{background:"linear-gradient(135deg,#06b6d4,#0891b2)",border:"none",borderRadius:10,padding:"10px 16px",color:"white",fontSize:14,fontWeight:700,cursor:"pointer",whiteSpace:"nowrap",flexShrink:0}}>–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button></div>
</div>
):(<div style={{background:"rgba(34,211,238,0.08)",border:"1px solid rgba(34,211,238,0.2)",borderRadius:16,padding:"14px 18px",marginBottom:16,textAlign:"center"}}><p style={{color:"#22d3ee",fontSize:14,fontWeight:700,margin:0}}>‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ!</p></div>)}

<Testimonial text="–ü–æ–∫–∞–∑–∞–ª –º–∞–º–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç. –û–Ω–∞ –≤–ø–µ—Ä–≤—ã–µ —Å–∫–∞–∑–∞–ª–∞: '–ê –º–æ–∂–µ—Ç —Ç—ã –∏ –ø—Ä–∞–≤, –¥–∞–≤–∞–π –ø–æ–ø—Ä–æ–±—É–µ–º'. –ì–æ–¥ –ø—ã—Ç–∞–ª—Å—è –æ–±—ä—è—Å–Ω–∏—Ç—å —á—Ç–æ –Ω–µ —Ö–æ—á—É –≤ –º–µ–¥ ‚Äî –∞ —Ç—É—Ç AI –∑–∞ 15 –º–∏–Ω—É—Ç –ø–æ–º–æ–≥ –Ω–∞–º –ø–æ–Ω—è—Ç—å –¥—Ä—É–≥ –¥—Ä—É–≥–∞." name="–¥–∞–Ω–∏–ª_17–ª–µ—Ç" emoji="üí™"/>

<h3 style={{color:"#e2e8f0",fontSize:16,fontWeight:800,marginBottom:12,marginTop:24}}>–ß—Ç–æ –µ—â—ë –º–æ–∂–Ω–æ? üëá</h3>
<div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:8}}>
{[{e:"üó∫",t:"–†–æ–∞–¥–º–∞–ø –∫ –º–µ—á—Ç–µ",d:"–ü–ª–∞–Ω –Ω–∞ 3-6 –º–µ—Å—è—Ü–µ–≤",f:"roadmap"},{e:"üè¢",t:"–ö–µ–π—Å –æ—Ç –∫–æ–º–ø–∞–Ω–∏–∏",d:"–†–µ–∞–ª—å–Ω–∞—è –∑–∞–¥–∞—á–∞",f:"case"},{e:"üë•",t:"–ù–∞–π—Ç–∏ —Ç–∞–∫–∏—Ö –∂–µ",d:"–ö–æ–º—å—é–Ω–∏—Ç–∏",f:"community"},{e:"üíå",t:"–ü–∏—Å—å–º–æ —Ä–æ–¥–∏—Ç–µ–ª—è–º",d:"AI –æ–±—ä—è—Å–Ω–∏—Ç –∑–∞ —Ç–µ–±—è",f:"parents"}].filter(x=>x.f!==sf).map(x=>(
<button key={x.f} onClick={()=>clickFD(x.f)} style={{background:"rgba(6,182,212,0.05)",border:"1px solid rgba(6,182,212,0.12)",borderRadius:14,padding:"12px 14px",cursor:"pointer",textAlign:"left",width:"100%"}}>
<div style={{fontSize:20,marginBottom:4}}>{x.e}</div><div style={{color:"#e2e8f0",fontWeight:700,fontSize:13,marginBottom:2}}>{x.t}</div><div style={{color:"#94a3b8",fontSize:11}}>{x.d}</div></button>))}
</div>
<div style={{marginTop:8,display:"flex",flexDirection:"column",gap:8}}>
{sf!=='ai_clone'&&<button onClick={()=>clickFD('ai_clone')} style={{background:"rgba(6,182,212,0.05)",border:"1px solid rgba(6,182,212,0.12)",borderRadius:14,padding:"12px 14px",cursor:"pointer",textAlign:"left",width:"100%"}}><div style={{fontSize:20,marginBottom:4}}>ü§ñ</div><div style={{color:"#e2e8f0",fontWeight:700,fontSize:13,marginBottom:2}}>–ú–æ–π AI-–∫–ª–æ–Ω</div><div style={{color:"#94a3b8",fontSize:11}}>–¶–∏—Ñ—Ä–æ–≤–∞—è –≤–µ—Ä—Å–∏—è —Ç–µ–±—è</div></button>}
{sf!=='deeper'&&<button onClick={()=>clickFD('deeper')} style={{background:"rgba(6,182,212,0.05)",border:"1px solid rgba(6,182,212,0.12)",borderRadius:14,padding:"12px 14px",cursor:"pointer",textAlign:"left",width:"100%"}}><div style={{fontSize:20,marginBottom:4}}>üîÆ</div><div style={{color:"#e2e8f0",fontWeight:700,fontSize:13,marginBottom:2}}>–ü–æ–π—Ç–∏ –≥–ª—É–±–∂–µ</div><div style={{color:"#94a3b8",fontSize:11}}>–ó–∞–ø–æ–ª–Ω–∏—Ç—å DNA –¥–æ 100%</div></button>}
</div>
<div style={{textAlign:"center",marginTop:28}}><button onClick={onReset} style={{background:"none",border:"none",color:"#455a64",fontSize:13,cursor:"pointer",textDecoration:"underline",textUnderlineOffset:3}}>‚Üê –ù–∞—á–∞—Ç—å —Å–Ω–∞—á–∞–ª–∞</button></div>
</div>

{modal&&(
<div style={{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0,0,0,0.7)",display:"flex",alignItems:"center",justifyContent:"center",zIndex:100,padding:20}} onClick={()=>setModal(false)}>
<div style={{background:"#1a1a2e",border:"1px solid rgba(6,182,212,0.15)",borderRadius:20,padding:24,maxWidth:340,width:"100%",textAlign:"center",animation:"fadeSlideUp 0.3s"}} onClick={e=>e.stopPropagation()}>
<div style={{fontSize:40,marginBottom:10}}>üöß</div>
<h3 style={{color:"#e2e8f0",fontSize:18,fontWeight:800,marginBottom:6}}>–°–∫–æ—Ä–æ –∑–∞–ø—É—Å–∫–∞–µ–º!</h3>
<p style={{color:"#94a3b8",fontSize:13,lineHeight:1.5,marginBottom:16}}>–û—Å—Ç–∞–≤—å –∫–æ–Ω—Ç–∞–∫—Ç ‚Äî –Ω–∞–ø–∏—à–µ–º –ø–µ—Ä–≤–æ–º—É.</p>
<div style={{display:"flex",gap:6,marginBottom:12}}>
<input value={fdEmail[modal]||''} onChange={e=>setFdEmail({...fdEmail,[modal]:e.target.value})} placeholder="@telegram –∏–ª–∏ email" style={{flex:1,minWidth:0,background:"rgba(6,182,212,0.06)",border:"1px solid rgba(6,182,212,0.2)",borderRadius:10,padding:"10px 14px",color:"#e2e8f0",fontSize:14,outline:"none"}}/>
<button onClick={()=>saveFdEmail(modal)} style={{background:"linear-gradient(135deg,#06b6d4,#0891b2)",border:"none",borderRadius:10,padding:"10px 14px",color:"white",fontSize:13,fontWeight:700,cursor:"pointer",flexShrink:0}}>OK</button>
</div>
<button onClick={()=>setModal(false)} style={{width:"100%",background:"rgba(255,255,255,0.05)",border:"1px solid rgba(255,255,255,0.1)",borderRadius:10,padding:10,color:"#94a3b8",fontSize:13,cursor:"pointer"}}>–ó–∞–∫—Ä—ã—Ç—å</button>
</div></div>)}
</div>);
};

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê APP ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function App(){
const[screen,setScreen]=useState('landing');
const[userName,setUserName]=useState('');
const[copilotName,setCopilotName]=useState('');
const[userId,setUserId]=useState(null);
const[sessionId,setSessionId]=useState(null);
const[finalDna,setFinalDna]=useState(0);
const[finalTraits,setFinalTraits]=useState([]);
const[finalNote,setFinalNote]=useState('');
const[finalFeature,setFinalFeature]=useState('roadmap');
const handleOnboard=async(name,cop)=>{
  setUserName(name);setCopilotName(cop);
  const user=await sbPost('users',{name,copilot_name:cop});
  if(user){setUserId(user.id);const ses=await sbPost('sessions',{user_id:user.id});if(ses)setSessionId(ses.id)}
  setScreen('chat');
};
const handleComplete=(d,t,note,feat)=>{setFinalDna(d);setFinalTraits(t||[]);setFinalNote(note||'');setFinalFeature(feat||'roadmap');sbPatch('sessions',sessionId,{ended_at:new Date().toISOString()});setScreen('summary')};
const handleReset=()=>{setUserName('');setCopilotName('');setUserId(null);setSessionId(null);setFinalDna(0);setFinalTraits([]);setFinalNote('');setFinalFeature('roadmap');setScreen('landing')};
return(<div>
{screen==='landing'&&<Landing onStart={()=>setScreen('onboarding')}/>}
{screen==='onboarding'&&<Onboarding onSubmit={handleOnboard}/>}
{screen==='chat'&&<Chat userName={userName} copilotName={copilotName} userId={userId} sessionId={sessionId} onComplete={handleComplete}/>}
{screen==='summary'&&<Summary userName={userName} copilotName={copilotName} dna={finalDna} traits={finalTraits} copilotNote={finalNote} suggestedFeature={finalFeature} userId={userId} onReset={handleReset}/>}
</div>);
}
ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
